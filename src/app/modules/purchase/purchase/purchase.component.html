<mat-sidenav-container>

  <mat-sidenav class="match-parent-side" #sidenav [mode]="enoughWidth()?'side':'over'" [opened]="enoughWidth()">
    <app-admin-drawer></app-admin-drawer>
  </mat-sidenav>

  <mat-sidenav-content (swiperight)="openDrawer(sidenav)">
    <app-toolbar [heading]="'Purchases'"
                 (searchCallback)="handleSearch($event)"
                 [showSearch]="true"
                 searchPlaceholder="Search purchase"
                 [sidenav]="sidenav" [showProgress]="false">
    </app-toolbar>

    <div *ngIf="!isMobile" style="margin-top: 16px" class="container">
      <mat-tab-group color="primary">
        <mat-tab label="All">
          <mat-card class="mat-elevation-z0">
            <mat-card-title class="d-flex flex-row flex-nowrap">
              <button routerLink="/purchase/create" mat-flat-button color="primary" class="ft-button">Add Purchase
              </button>
              <span class="toolbar-spacer"></span>
              <button *ngIf="!getPurchaseProgress" [matMenuTriggerFor]="pAoptions" color="primary" mat-icon-button>
                <mat-icon>
                  more_vert
                </mat-icon>
              </button>
              <mat-menu #pAoptions>
                <button mat-menu-item (click)="reload()">Reload</button>
                <!--      <button mat-menu-item>Export</button>-->
              </mat-menu>
            </mat-card-title>
            <mat-card-content>


              <table mat-table [dataSource]="purchasesDatasource"
                     *ngIf="!getPurchaseProgress && purchasesDatasource && purchasesDatasource.data.length>0">
                <ng-container matColumnDef="refNumber">
                  <th mat-header-cell *matHeaderCellDef>Ref#</th>
                  <td mat-cell *matCellDef="let purchase">{{purchase.refNumber}}</td>
                </ng-container>
                <ng-container matColumnDef="channel">
                  <th mat-header-cell *matHeaderCellDef>Channel</th>
                  <td mat-cell *matCellDef="let purchase">{{purchase.type}}</td>
                </ng-container>
                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef>Amount ( TZS )</th>
                  <td mat-cell *matCellDef="let purchase">{{purchase.amount | number}}</td>
                </ng-container>
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Status</th>
                  <td mat-cell *matCellDef="let purchase">{{purchase.paid ? 'Paid' : 'Not Paid'}}</td>
                </ng-container>
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>
                    <div class="d-flex justify-content-end align-items-end">
                      <span>Actions</span>
                    </div>
                  </th>
                  <td mat-cell *matCellDef="let purchase">
                    <div class="d-flex justify-content-end align-items-end">
                      <button [matMenuTriggerFor]="opts" color="primary" mat-icon-button>
                        <mat-icon>more_vert</mat-icon>
                      </button>
                      <mat-menu #opts>
                        <button (click)="showPurchaseDetails(purchase)" mat-menu-item>View</button>
                        <button (click)="recordPayment(purchase)" mat-menu-item *ngIf="!purchase.paid">Record Payment
                        </button>
                      </mat-menu>
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="purchaseTableColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: purchaseTableColumns;"></tr>

              </table>

              <mat-card-title style="margin-top: 8px"
                              *ngIf="!getPurchaseProgress && purchasesDatasource && purchasesDatasource.data.length>0">
                <button [disabled]="loadMoreProgress" (click)="loadMore()" mat-button color="primary">
                  Load More
                  <mat-progress-spinner style="display: inline-block" [diameter]="20" mode="indeterminate"
                                        *ngIf="loadMoreProgress"
                                        matTooltip="'Load more data'"
                                        color="primary"></mat-progress-spinner>
                </button>
              </mat-card-title>

              <mat-progress-spinner [diameter]="30" mode="indeterminate" color="primary"
                                    *ngIf="getPurchaseProgress"
                                    matTooltip="'Fetching all purchases'"></mat-progress-spinner>
            </mat-card-content>
          </mat-card>

        </mat-tab>
      </mat-tab-group>
    </div>

    <app-purchase-mobile *ngIf="isMobile"></app-purchase-mobile>

    <app-bottom-bar *ngIf="isMobile && !enoughWidth()"></app-bottom-bar>
  </mat-sidenav-content>

</mat-sidenav-container>

