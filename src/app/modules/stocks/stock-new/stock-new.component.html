<mat-sidenav-container class="match-parent">
  <mat-sidenav class="match-parent-side"
               [fixedInViewport]="true"
               #sidenav
               [mode]="enoughWidth()?'side':'over'"
               [opened]="enoughWidth()">
    <app-admin-drawer></app-admin-drawer>
  </mat-sidenav>

  <mat-sidenav-content>
    <app-toolbar [heading]="'Create Stock'"
                 [sidenav]="sidenav"
                 [hasBackRoute]="isMobile"
                 backLink="/stock/products"
                 [showProgress]="false">
    </app-toolbar>

    <div class="container stock-new-wrapper">

      <div style="padding: 16px" class="row d-flex flex-column justify-content-center align-items-center">

        <h5 style="padding: 0" class="col-12 col-xl-9 col-lg-9">
          Image
        </h5>

        <mat-card matRipple (click)="imageInput.click()"
                  class="col-12 col-xl-9 col-lg-9 d-flex flex-column justify-content-center align-items-center"
                  style="width: 100%; min-height: 100px; border-radius: 4px; background-color: #f5f5f5">
          <img matCardImageLarge style="width: 100%; height: auto; margin-top: 4px" [src]="croppedImage" alt=""/>
          <button *ngIf="!croppedImage" mat-button color="primary">Upload Image</button>
        </mat-card>

        <div *ngIf="croppedImage" style="padding: 0"
             class="col-12 col-xl-9 col-lg-9 d-flex justify-content-center align-items-center">
          <button color="warn" (click)="removeImage(imageInput)" mat-button>Remove Image</button>
        </div>
        <input (change)="fileChangeEvent($event)" #imageInput style="display: none" type="file">

      </div>

      <form [formGroup]="productForm" #formElement="ngForm" (ngSubmit)="addProduct(formElement)">

        <div class="row d-flex justify-content-center align-items-center">

          <div style="margin-bottom: 16px" class="col-12 col-xl-9 col-lg-9">

            <h5>
              Status
            </h5>
            <mat-card class="card-wrapper">
              <mat-list>
                <mat-list-item>
                  <p matLine>Can be sold</p>
                  <mat-checkbox formControlName="saleable" matSuffix></mat-checkbox>
                </mat-list-item>
                <mat-list-item>
                  <p matLine>Can be stocked</p>
                  <mat-checkbox formControlName="stockable" matSuffix></mat-checkbox>
                </mat-list-item>
                <mat-list-item>
                  <p matLine>Can be downloaded</p>
                  <mat-checkbox formControlName="downloadable" matSuffix></mat-checkbox>
                </mat-list-item>
                <mat-list-item>
                  <p matLine>Can be purchased</p>
                  <mat-checkbox formControlName="purchasable" matSuffix></mat-checkbox>
                </mat-list-item>
              </mat-list>
            </mat-card>

            <h5 *ngIf="getDownloadAbleFormControl().value === true">
              Files
            </h5>
            <div *ngIf="getDownloadAbleFormControl().value === true" class="card-wrapper">
              <app-upload-files [uploadFileFormControl]="getDownloadsFormControl()"></app-upload-files>
            </div>

            <h5>
              Product
            </h5>
            <mat-card class="card-wrapper">
              <mat-card-content class="card-content">
                <mat-form-field appearance="fill" class="my-input">
                  <mat-label>Product Name</mat-label>
                  <input matInput type="text" required formControlName="product">
                  <mat-error>Product name required</mat-error>
                </mat-form-field>

                <mat-form-field appearance="fill" class="my-input">
                  <mat-label>Description</mat-label>
                  <textarea matInput type="text" formControlName="description"></textarea>
                </mat-form-field>

                <mat-form-field appearance="outline" class="my-input">
                  <mat-label>Category</mat-label>
                  <mat-select [multiple]="false" formControlName="category">
                    <mat-option *ngFor="let category of categories | async" [value]="category.name">
                      {{category.name}}
                    </mat-option>
                  </mat-select>
                  <mat-progress-spinner matTooltip="Fetching units"
                                        *ngIf="categoriesFetching" matSuffix color="accent"
                                        mode="indeterminate"
                                        [diameter]="20"></mat-progress-spinner>
                  <mat-error>Category required</mat-error>
                  <div matSuffix class="d-flex flex-row">
                    <button (click)="refreshCategories($event)" mat-icon-button matTooltip="refresh categories"
                            *ngIf="!categoriesFetching">
                      <mat-icon>refresh</mat-icon>
                    </button>
                    <button (click)="addNewCategory($event)" mat-icon-button matTooltip="add new category"
                            *ngIf="!categoriesFetching">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </mat-form-field>

                <mat-form-field *ngIf="getPurchasableFormControl().value === true" appearance="outline"
                                class="my-input">
                  <mat-label>Supplier</mat-label>
                  <mat-select [multiple]="false" formControlName="supplier">
                    <mat-option *ngFor="let supplier of suppliers | async" [value]="supplier.name">
                      {{supplier.name}}
                    </mat-option>
                  </mat-select>
                  <mat-progress-spinner matTooltip="Fetching suppliers"
                                        *ngIf="suppliersFetching" matSuffix color="accent"
                                        mode="indeterminate"
                                        [diameter]="20"></mat-progress-spinner>
                  <mat-error>Supplier required</mat-error>
                  <div matSuffix class="d-flex flex-row">
                    <button (click)="refreshSuppliers($event)" mat-icon-button matTooltip="refresh suppliers"
                            *ngIf="!suppliersFetching">
                      <mat-icon>refresh</mat-icon>
                    </button>
                    <button (click)="addNewSupplier($event)" mat-icon-button matTooltip="add new supplier"
                            *ngIf="!suppliersFetching">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </mat-form-field>

              </mat-card-content>
            </mat-card>

            <h5>
              Inventory
            </h5>
            <mat-card class="card-wrapper">
              <mat-card-content class="card-content">
                <mat-form-field *ngIf="getPurchasableFormControl().value === true" appearance="fill" class="my-input">
                  <mat-label>Purchase Price / Unit</mat-label>
                  <span matSuffix>TZS</span>
                  <input min="0" matInput type="number" required formControlName="purchase">
                  <mat-error>Purchase price required</mat-error>
                </mat-form-field>

                <mat-form-field *ngIf="getSaleableFormControl().value === true" appearance="fill" class="my-input">
                  <mat-label>Retail Price / Unit</mat-label>
                  <span matSuffix>TZS</span>
                  <input min="0" matInput type="number" required formControlName="retailPrice">
                  <mat-error>Retail price required</mat-error>
                </mat-form-field>

                <mat-form-field *ngIf="getSaleableFormControl().value === true" appearance="fill" class="my-input">
                  <mat-label>Wholesale Price / Unit</mat-label>
                  <span matSuffix>TZS</span>
                  <input min="0" matInput type="number" required formControlName="wholesalePrice">
                  <mat-error>Wholesale price required</mat-error>
                </mat-form-field>

                <mat-form-field *ngIf="getSaleableFormControl().value === true" appearance="fill" class="my-input"
                                matTooltip="Quantity for this product to be sold as a whole or in bulk">
                  <mat-label>Wholesale Quantity</mat-label>
                  <input min="0" matInput
                         type="number"
                         required formControlName="wholesaleQuantity">
                  <mat-error>Wholesale Quantity required</mat-error>
                </mat-form-field>

                <mat-form-field *ngIf="getStockableFormControl().value === true" appearance="fill" class="my-input"
                                matTooltip="Total initial unit quantity available">
                  <mat-label>Quantity</mat-label>
                  <input min="0" matInput type="number" required
                         formControlName="quantity">
                  <mat-error>Quantity required</mat-error>
                </mat-form-field>

                <mat-form-field *ngIf="getStockableFormControl().value === true" appearance="fill" class="my-input">
                  <mat-label>Reorder Level</mat-label>
                  <input min="0" matInput type="number" required formControlName="reorder">
                  <mat-error>Reorder field required</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="my-input">
                  <mat-label>Unit</mat-label>
                  <mat-select formControlName="unit">
                    <mat-option *ngFor="let unit of units | async" [value]="unit.name">
                      {{unit.name}}
                    </mat-option>
                  </mat-select>
                  <mat-progress-spinner matTooltip="Fetching units"
                                        *ngIf="unitsFetching" matSuffix color="accent"
                                        mode="indeterminate"
                                        [diameter]="20"></mat-progress-spinner>
                  <mat-error>Unit required</mat-error>
                  <div matSuffix class="d-flex flex-row">
                    <button (click)="refreshUnits($event)" mat-icon-button matTooltip="refresh units"
                            *ngIf="!unitsFetching">
                      <mat-icon>refresh</mat-icon>
                    </button>
                    <button (click)="addNewUnit($event)" mat-icon-button matTooltip="add new unit"
                            *ngIf="!unitsFetching">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </mat-form-field>

                <mat-checkbox matTooltip="Select if a product can expire" labelPosition="after"
                              class="my-input"
                              formControlName="canExpire">
                  Can Expire?
                </mat-checkbox>

                <mat-form-field *ngIf="getCanExpireFormControl().value === true" appearance="outline" class="my-input">
                  <mat-label>Expire Date</mat-label>
                  <input matInput [matDatepicker]="picker" formControlName="expire">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker [touchUi]="true" #picker></mat-datepicker>
                </mat-form-field>

              </mat-card-content>
            </mat-card>

          </div>

          <div class="col-12 col-xl-9 col-lg-9" style="margin-bottom: 16px">
            <!--            <mat-card class="card-wrapper mat-elevation-z1">-->

            <!--              <mat-card-content class="card-content">-->
            <!--                <mat-checkbox-->
            <!--                  labelPosition="after"-->
            <!--                  formControlName="active"-->
            <!--                  matTooltip="If selected a product can be bought by a customer and be sold by a seller ">-->
            <!--                  Active?-->
            <!--                </mat-checkbox>-->

            <!--              </mat-card-content>-->

            <!--            </mat-card>-->

            <div>
              <button class="btn-block ft-button" color="primary" mat-raised-button
                      [disabled]="mainProgress">
                Create Product
                <mat-progress-spinner style="display: inline-block" *ngIf="mainProgress" diameter="30"
                                      mode="indeterminate"></mat-progress-spinner>
              </button>
              <div style="padding: 16px 0">
                <button class="btn-block" routerLink="/stock" color="primary" mat-button>
                  Cancel
                </button>
              </div>
            </div>

          </div>

        </div>
      </form>
    </div>
  </mat-sidenav-content>

</mat-sidenav-container>

