!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("localforage"),require("@angular/core"),require("typescript-lazy-get-decorator")):"function"==typeof define&&define.amd?define("ngforage",["exports","localforage","@angular/core","typescript-lazy-get-decorator"],t):t(e.ngforage={},e.localforage,e.ng.core,e.LazyGet)}(this,function(e,t,r,n){"use strict";var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function i(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var c=require("localforage"),f="defineDriver"in c?c:c["default"],u=require("localforage/src/utils/serializer"),p=u["default"]||u;function g(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function h(){return"undefined"!=typeof sessionStorage&&(!function(){var e="_localforage_support_test";try{return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!1}catch(t){return!0}}()||0<sessionStorage.length)}function l(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function y(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var d="ngforage_sessionStorage",b={_driver:d,_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=g(e,this._defaultConfig),h()?((this._dbInfo=t).serializer=p,Promise.resolve()):Promise.reject(new Error("Local storage unusable"))},_support:h(),clear:function(e){var n=this,t=this.ready().then(function(){for(var e=n._dbInfo.keyPrefix,t=sessionStorage.length-1;0<=t;t--){var r=sessionStorage.key(t);null!==r&&0===r.indexOf(e)&&sessionStorage.removeItem(r)}});return l(t,e),t},dropInstance:function(t,e){var r,n=this;if(e=function(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var o=this.config();t.name=t.name||o.name,t.storeName=t.storeName||o.storeName}return l(r=t.name?new Promise(function(e){t.storeName?e(g(t,n._defaultConfig)):e(t.name+"/")}).then(function(e){for(var t=sessionStorage.length-1;0<=t;t--){var r=sessionStorage.key(t);null!==r&&0===r.indexOf(e)&&sessionStorage.removeItem(r)}}):Promise.reject("Invalid arguments"),e),r},getItem:function(t,e){var r=this;t=y(t);var n=this.ready().then(function(){var e=sessionStorage.getItem(""+r._dbInfo.keyPrefix+t);return e&&(e=r._dbInfo.serializer.deserialize(e)),e});return l(n,e),n},iterate:function(a,e){var c=this,t=this.ready().then(function(){for(var e=c._dbInfo.keyPrefix,t=e.length,r=sessionStorage.length,n=1,o=0;o<r;o++){var i=sessionStorage.key(o);if(null!==i&&0===i.indexOf(e)){var s=sessionStorage.getItem(i);if(s&&(s=c._dbInfo.serializer.deserialize(s)),void 0!==(s=a(s,i.substring(t),n++)))return s}}});return l(t,e),t},key:function(r,e){var n=this,t=this.ready().then(function(){var e;try{e=sessionStorage.key(r)}catch(t){e=null}return e&&(e=e.substring(n._dbInfo.keyPrefix.length)),e});return l(t,e),t},keys:function(e){var o=this,t=this.ready().then(function(){for(var e=sessionStorage.length,t=[],r=0;r<e;r++){var n=sessionStorage.key(r);null!==n&&0===n.indexOf(o._dbInfo.keyPrefix)&&t.push(n.substring(o._dbInfo.keyPrefix.length))}return t});return l(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return l(t,e),t},removeItem:function(e,t){var r=this;e=y(e);var n=this.ready().then(function(){sessionStorage.removeItem(""+r._dbInfo.keyPrefix+e)});return l(n,t),n},setItem:function(s,e,t){var a=this;s=y(s);var r=this.ready().then(function(){e===undefined&&(e=null);var i=e;return new Promise(function(n,o){a._dbInfo.serializer.serialize(e,function(e,t){if(t)o(t);else try{sessionStorage.setItem(""+a._dbInfo.keyPrefix+s,e),n(i)}catch(r){"QuotaExceededError"!==r.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==r.name||o(r),o(r)}})})});return l(r,t),r}};f.defineDriver(b)["catch"](console.error);var m=new r.InjectionToken("Default NgForage config"),v=function(){function t(){}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:m,useValue:Object.assign({},e)}]}},t}();v.decorators=[{type:r.NgModule,args:[{}]}];var I=Symbol("Default Config"),j=function(){function e(e){this[I]={cacheTime:3e5,description:"",driver:[f.INDEXEDDB,f.WEBSQL,f.LOCALSTORAGE],name:"ngForage",size:4980736,storeName:"ng_forage",version:1},e&&this.configure(e)}return Object.defineProperty(e.prototype,"cacheTime",{get:function(){return this[I].cacheTime},set:function(e){this[I].cacheTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return{cacheTime:this.cacheTime,description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this[I].description},set:function(e){this[I].description=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return"string"==typeof this[I].driver?this[I].driver:this[I].driver.slice()},set:function(e){this[I].driver=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this[I].name},set:function(e){this[I].name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this[I].size},set:function(e){this[I].size=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return this[I].storeName},set:function(e){this[I].storeName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this[I].version},set:function(e){this[I].version=e},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return"driver"in(e=e||{})&&e.driver.slice&&(e.driver=e.driver.slice()),Object.assign(this[I],e),this},e.prototype.defineDriver=function(e){return f.defineDriver(e)},e.prototype.toJSON=function(){return this.config},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();j.DRIVER_INDEXEDDB=f.INDEXEDDB,j.DRIVER_LOCALSTORAGE=f.LOCALSTORAGE,j.DRIVER_SESSIONSTORAGE=d,j.DRIVER_WEBSQL=f.WEBSQL,j.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],j.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Optional},{type:r.Inject,args:[m]}]}]},j.ngInjectableDef=r.defineInjectable({factory:function(){return new j(r.inject(m,8))},token:j,providedIn:"root"}),Object.defineProperty(j.prototype,Symbol.toStringTag,{value:"NgForageConfig"});var O={};var S=Symbol("Config"),N=function(){function e(e){this[S]=e}return e.prototype.getInstance=function(e){e=Object.assign({},this[S].config,e||{});var t,r,n=[(r=(t=e).driver,r?"string"==typeof r?r:r.slice().sort().join(","):""),t.name,t.size,t.storeName,t.version,t.description,t.cacheTime].join("|");return O[n]||(O[n]=f.createInstance(e)),O[n]},e}();N.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],N.ctorParameters=function(){return[{type:j}]},N.ngInjectableDef=r.defineInjectable({factory:function(){return new N(r.inject(j))},token:N,providedIn:"root"}),Object.defineProperty(N.prototype,Symbol.toStringTag,{value:"InstanceFactory"});var P=Symbol("Store"),_=function(){function e(e,t){this.config={},this.storeNeedsRecalc=!0,this.baseConfig=e,this.fact=t}return Object.defineProperty(e.prototype,"description",{get:function(){return"description"in this.config?this.config.description:this.baseConfig.description},set:function(e){this.config.description=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return"driver"in this.config?this.config.driver:this.baseConfig.driver},set:function(e){this.config.driver=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return"name"in this.config?this.config.name:this.baseConfig.name},set:function(e){this.config.name=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return"size"in this.config?this.config.size:this.baseConfig.size},set:function(e){this.config.size=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return"storeName"in this.config?this.config.storeName:this.baseConfig.storeName},set:function(e){this.config.storeName=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return"version"in this.config?this.config.version:this.baseConfig.version},set:function(e){this.config.version=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"finalConfig",{get:function(){return Object.assign({},this.baseConfig.config,this.config)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return!this.storeNeedsRecalc&&this[P]||(this[P]=this.fact.getInstance(this.finalConfig),this.storeNeedsRecalc=!1),this[P]},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return"driver"in(e=e||{})&&e.driver.slice&&(e.driver=e.driver.slice()),Object.assign(this.config,e),this.storeNeedsRecalc=!0,this},e.prototype.toJSON=function(){return{description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();_.ctorParameters=function(){return[{type:j,decorators:[{type:r.Inject,args:[j]}]},{type:N,decorators:[{type:r.Inject,args:[N]}]}]},Object.defineProperty(_.prototype,Symbol.toStringTag,{value:"BaseConfigurable"});var C=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return i(r,e),Object.defineProperty(r.prototype,"activeDriver",{get:function(){return this.store.driver()},enumerable:!0,configurable:!0}),r.prototype.clear=function(){return this.store.clear()},r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getItem=function(e){return this.store.getItem(e)},r.prototype.iterate=function(e){return this.store.iterate(e)},r.prototype.key=function(e){return this.store.key(e)},r.prototype.keys=function(){return this.store.keys()},r.prototype.length=function(){return this.store.length()},r.prototype.ready=function(){return this.store.ready()},r.prototype.removeItem=function(e){return this.store.removeItem(e)},r.prototype.setItem=function(e,t){return this.store.setItem(e,t)},r.prototype.supports=function(e){return this.store.supports(e)},r}(_);C.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],C.ngInjectableDef=r.defineInjectable({factory:function(){return new C(r.inject(j),r.inject(N))},token:C,providedIn:"root"}),Object.defineProperty(C.prototype,Symbol.toStringTag,{value:"NgForage"});var x=function(){function e(e,t){this.data=e,this.expires=new Date("number"==typeof t?t:0)}return Object.defineProperty(e.prototype,"expired",{get:function(){return 0===this.expiresIn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiresIn",{get:function(){return Math.max(0,this.expires.getTime()-Date.now())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasData",{get:function(){return null!==this.data},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{data:this.data,expired:this.expired,expires:this.expires,expiresIn:this.expiresIn,hasData:this.hasData}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();function D(e){return{data:e+"_data",expiry:e+"_expiry"}}function R(e){return new x(e[0],e[1])}function T(e){return e[0]}function k(){}s([n.LazyGetter(),a("design:type",Boolean),a("design:paramtypes",[])],x.prototype,"expired",null),s([n.LazyGetter(),a("design:type",Number),a("design:paramtypes",[])],x.prototype,"expiresIn",null),s([n.LazyGetter(),a("design:type",Boolean),a("design:paramtypes",[])],x.prototype,"hasData",null),Object.defineProperty(x.prototype,Symbol.toStringTag,{value:"CachedItem"});var z=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return i(r,t),Object.defineProperty(r.prototype,"cacheTime",{get:function(){return"cacheTime"in this.config?this.config.cacheTime:this.baseConfig.cacheTime},set:function(e){this.config.cacheTime=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getCached=function(e){var t=D(e),r=this.getItem(t.data),n=this.getItem(t.expiry);return Promise.all([r,n]).then(R)},r.prototype.removeCached=function(e){var t=D(e),r=this.removeItem(t.data),n=this.removeItem(t.expiry);return Promise.all([r,n]).then(k)},r.prototype.setCached=function(e,t,r){var n=D(e),o="number"==typeof r?r:this.cacheTime,i=this.setItem(n.data,t),s=this.setItem(n.expiry,Date.now()+o);return Promise.all([i,s]).then(T)},r.prototype.toJSON=function(){var e={cacheTime:this.cacheTime};return Object.assign(t.prototype.toJSON.call(this),e)},r}(C);z.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],z.ngInjectableDef=r.defineInjectable({factory:function(){return new z(r.inject(j),r.inject(N))},token:z,providedIn:"root"}),Object.defineProperty(z.prototype,Symbol.toStringTag,{value:"NgForageCache"});var E=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return i(r,e),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r}(z);Object.defineProperty(E.prototype,Symbol.toStringTag,{value:"NgForageCache (dedicated)"});var w=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return i(r,e),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r}(C);Object.defineProperty(w.prototype,Symbol.toStringTag,{value:"NgForage (dedicated)"});var F=Symbol("NgForageConfig"),L=Symbol("InstanceFactory"),J=function(){function e(e,t){this[F]=e,this[L]=t}return e.prototype.createCache=function(e){var t=new E(this[F],this[L]);return e&&t.configure(e),t},e.prototype.createNgForage=function(e){var t=new w(this[F],this[L]);return e&&t.configure(e),t},e}();J.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],J.ctorParameters=function(){return[{type:j},{type:N}]},J.ngInjectableDef=r.defineInjectable({factory:function(){return new J(r.inject(j),r.inject(N))},token:J,providedIn:"root"}),e.NgForageModule=v,e.NgForage=C,e.NgForageCache=z,e.NgForageConfig=j,e.InstanceFactory=N,e.DedicatedInstanceFactory=J,e.ɵa=m,e.ɵb=_,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngforage.umd.min.js.map
