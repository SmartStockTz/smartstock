(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{VC8i:function(t,e,n){"use strict";n.r(e),n.d(e,"SalesModule",(function(){return Ze}));var r=n("ofXK"),o=n("/1cH"),i=n("bTqV"),a=n("Wp6s"),c=n("iadO"),s=n("f0Cb"),u=n("kmnG"),l=n("NFeN"),d=n("qFsG"),p=n("M9IT"),b=n("Xa2L"),h=n("XhcP"),f=n("1jcm"),m=n("Dh3D"),g=n("+0xr"),v=n("wZkO"),y=n("Qu3c"),w=n("3Pt+"),C=n("doIf"),S=n("nBS7"),k=n("LRne"),_=n("Qfq9"),P=n("4vfi"),R=n("ZCQq"),x=n("fXoL"),I=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},O=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},F=function(){function t(t){this._storage=t}return t.prototype.getSalesByUser=function(t,e){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.saveOrder=function(t){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.saveOrders=function(t){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.deleteOrder=function(t){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.getOrders=function(){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.getOrder=function(t){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.updateOrder=function(t,e){return I(this,void 0,void 0,(function(){return O(this,(function(t){return[2,Promise.reject("not implemented")]}))}))},t.prototype.saveSales=function(t,e){return I(this,void 0,void 0,(function(){var n;return O(this,(function(r){switch(r.label){case 0:return n=[],t.forEach((function(t){t.cartId=e,t.batch=R.a.generateUUID(),n.push({method:"POST",body:t,path:"/classes/sales"})})),[4,this._storage.saveSales(n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getAllStock=function(){return I(this,void 0,void 0,(function(){var t,e;return O(this,(function(n){switch(n.label){case 0:return[4,this._storage.getActiveShop()];case 1:return t=n.sent(),[4,P.BFast.database(t.projectId).collection("stocks").getAll(void 0,{cacheEnable:!1,dtl:0})];case 2:return e=n.sent(),[4,this._storage.saveStocks(e)];case 3:return n.sent(),[2,e]}}))}))},t.\u0275fac=function(e){return new(e||t)(x.Wb(S.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"any"}),t}(),M=n("wROQ"),j=n("tyNb"),D=n("dNgK"),E=n("AytR"),B=n("soNi"),T=n("l8oG"),A=n("veC1"),N=n("VcMg"),W=function(){function t(t){this.storage=t}return t.prototype.getCustomers=function(){return this.storage.getCustomers()},t.prototype.saveCustomer=function(t){return this.storage.saveCustomer(t)},t.\u0275fac=function(e){return new(e||t)(x.Wb(S.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),V=n("gcOT"),L=n("tk/3"),q=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},Q=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Z=V.a.Plugins.Printer,G=function(){function t(t,e){this.settings=t,this.httpClient=e}return t.prototype.printInMobile=function(t){return q(this,void 0,void 0,(function(){return Q(this,(function(e){return[2,Z.print(t)]}))}))},t.prototype.printInDesktop=function(t){return q(this,void 0,void 0,(function(){return Q(this,(function(e){return this.url=E.a.printerUrl+"/print",[2,this.httpClient.post(this.url,{data:t.data,id:t.id},{headers:{"Access-Control-Allow-Origin":"*"},responseType:"text"}).toPromise()]}))}))},t.prototype.print=function(t){return q(this,void 0,void 0,(function(){var e,n;return Q(this,(function(r){switch(r.label){case 0:return[4,this.settings.getSettings()];case 1:return e=r.sent(),n=(n=(n=(n="").concat(e.printerHeader+"\n")).concat(t.data)).concat(e.printerFooter),t.data=n,E.a.production?E.a.android&&V.a.isNative&&!e.saleWithoutPrinter?[4,this.printInMobile(t)]:[3,3]:(console.warn("print services disabled in dev mode"),[2]);case 2:return[2,r.sent()];case 3:return!E.a.electron||e.saleWithoutPrinter?[3,5]:[4,this.printInDesktop(t)];case 4:return[2,r.sent()];case 5:return!E.a.browser||e.saleWithoutPrinter?[3,7]:[4,this.printInDesktop(t)];case 6:return[2,r.sent()];case 7:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(x.Wb(N.a),x.Wb(L.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),U=n("Jedy"),z=n("/t3+"),K=n("TU8p"),H=n("MutI"),$=n("FKr1");function J(t,e){if(1&t&&(x.Sb(0,"mat-option",23),x.Ec(1),x.Rb()),2&t){var n=e.$implicit;x.jc("value",n),x.Bb(1),x.Gc(" ",n," ")}}function X(t,e){if(1&t&&(x.Sb(0,"div",18),x.Sb(1,"div",19),x.Nb(2,"input",20),x.Sb(3,"mat-autocomplete",null,21),x.Cc(5,J,2,2,"mat-option",22),x.ec(6,"async"),x.Rb(),x.Rb(),x.Rb()),2&t){var n=x.pc(4),r=x.dc();x.Bb(2),x.jc("formControl",r.customerFormControl)("matAutocomplete",n),x.Bb(3),x.jc("ngForOf",x.fc(6,3,r.customers))}}function Y(t,e){if(1&t){var n=x.Tb();x.Sb(0,"div"),x.Sb(1,"mat-list-item"),x.Sb(2,"button",24),x.Zb("click",(function(){x.tc(n);var t=e.index;return x.dc().removeCart(t)})),x.Sb(3,"mat-icon",25),x.Ec(4,"delete"),x.Rb(),x.Rb(),x.Sb(5,"h4",26),x.Ec(6),x.Rb(),x.Sb(7,"mat-card-subtitle",26),x.Ec(8),x.ec(9,"number"),x.Rb(),x.Sb(10,"div",27),x.Sb(11,"button",28),x.Zb("click",(function(){x.tc(n);var t=e.index;return x.dc().decrementQty(t)})),x.Sb(12,"mat-icon"),x.Ec(13,"remove_circle"),x.Rb(),x.Rb(),x.Sb(14,"button",28),x.Zb("click",(function(){x.tc(n);var t=e.index;return x.dc().incrementQty(t)})),x.Sb(15,"mat-icon"),x.Ec(16,"add_circle"),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.Nb(17,"mat-divider",29),x.Rb()}if(2&t){var r=e.$implicit,o=x.dc();x.Bb(6),x.Fc(r.product.product),x.Bb(2),x.Ic("",o.isViewedInWholesale?"("+r.product.wholesaleQuantity+") ":"","",r.quantity," ",r.product.unit," @",o.isViewedInWholesale?r.product.wholesalePrice:r.product.retailPrice," = ",x.fc(9,6,r.quantity*(o.isViewedInWholesale?r.product.wholesalePrice:r.product.retailPrice))," ")}}function tt(t,e){1&t&&(x.Sb(0,"span"),x.Ec(1,"Checkout"),x.Rb())}function et(t,e){1&t&&x.Nb(0,"mat-progress-spinner",30)}var nt,rt=function(){function t(t,e,n,r,o,i,a){this.eventService=t,this.saleDatabase=e,this.settings=n,this.printer=r,this.userApi=o,this.customerApi=i,this.snack=a,this.isViewedInWholesale=!1,this.totalCost=0,this.discountFormControl=new w.f(0,[w.v.nullValidator,w.v.min(0)]),this.customerFormControl=new w.f("",[w.v.nullValidator,w.v.required,w.v.minLength(3)]),this.cartProductsArray=[],this.cartProducts=Object(k.a)(this.cartProductsArray),this.checkoutProgress=!1,this.isMobile=E.a.android}return t._getCartItemDiscount=function(t){return t.totalDiscount/t.totalItems},t.getQuantity=function(t,e){return t?e.quantity*e.stock.wholesaleQuantity:e.quantity},t.getPrice=function(t,e){return t?e.stock.wholesalePrice:e.stock.retailPrice},t.prototype.ngOnInit=function(){this.getUser(),this._cartListener(),this._discountListener(),this._hideCartListener(),this._handleCustomerNameControl(),this._getCustomers()},t.prototype.getUser=function(){var t=this;this.userApi.currentUser().then((function(e){t.currentUser=e})).catch((function(e){t.currentUser=void 0}))},t.prototype._handleCustomerNameControl=function(){var t=this;this.customersArray=[],this.customerFormControl.valueChanges.subscribe((function(e){e&&t.customerApi.getCustomers().then((function(n){n||(n=[]),t.customers=Object(k.a)(n.map((function(t){return t.displayName})).filter((function(t){return t.toLowerCase().startsWith(e.toLowerCase())})))})).catch()}))},t.prototype._cartListener=function(){var t=this;this.eventService.listen(T.a.ADD_CART,(function(e){var n=e.detail,r=t.cartProductsArray.find((function(t){return t.product.id===n.product.id}));if(null!=r){var o=t.cartProductsArray.indexOf(r);t.cartProductsArray[o].quantity=t.cartProductsArray[o].quantity+n.quantity}else t.cartProductsArray.push(n);t.cartProducts=Object(k.a)(t.cartProductsArray),t.eventService.broadcast(T.a.CART_ITEMS,t.cartProductsArray),t.eventService.broadcast(T.a.NO_OF_CART,t.cartProductsArray.map((function(t){return t.quantity})).reduce((function(t,e){return t+e}),0)),t._getTotal(t.discountFormControl.value)}))},t.prototype.getTotalCartItem=function(){var t=this.cartProductsArray.map((function(t){return t.quantity})).reduce((function(t,e){return t+e}),0);return this.eventService.broadcast(T.a.NO_OF_CART,t),t},t.prototype._getTotal=function(t){var e=this;null!=t&&(this.totalCost=this.cartProductsArray.map((function(t){return t.quantity*(e.isViewedInWholesale?t.product.wholesalePrice:t.product.retailPrice)})).reduce((function(t,e){return t+e}),-t)),this.eventService.broadcast(T.a.NO_OF_CART,this.cartProductsArray.length)},t.prototype.decrementQty=function(t){this.cartProducts.subscribe((function(e){e[t].quantity>1&&(e[t].quantity=e[t].quantity-1)})),this._getTotal(this.discountFormControl.value?this.discountFormControl.value:0)},t.prototype.incrementQty=function(t){this.cartProducts.subscribe((function(e){e[t].quantity=e[t].quantity+1})),this._getTotal(this.discountFormControl.value?this.discountFormControl.value:0)},t.prototype.removeCart=function(t){this.cartProductsArray.splice(t,1),this.cartProducts=Object(k.a)(this.cartProductsArray),this._getTotal(this.discountFormControl.value?this.discountFormControl.value:0)},t.prototype._discountListener=function(){var t=this;this.discountFormControl.valueChanges.subscribe((function(e){e||t._getTotal(0),isNaN(e)||t._getTotal(e)}))},t.prototype._hideCartListener=function(){var t=this;this.eventService.listen(T.a.NO_OF_CART,(function(e){e||e.detail||(t.cartdrawer.opened=!1),isNaN(e.detail)||0!==e.detail||(t.cartdrawer.opened=!1)}))},t.prototype.checkout=function(){!this.isViewedInWholesale||this.customerFormControl.valid?(this.checkoutProgress=!0,this.customerFormControl.valid&&this.customerApi.saveCustomer({displayName:this.customerFormControl.value}).catch(),this.printCart()):this.snack.open("Please enter customer name, atleast three characters required","Ok",{duration:3e3})},t.prototype._getCartItemSubAmount=function(e){return(this.isViewedInWholesale?e.quantity*e.product.wholesalePrice:e.quantity*e.product.retailPrice)-t._getCartItemDiscount({totalDiscount:e.totalDiscount,totalItems:e.totalItems})},t.prototype.submitBill=function(t){return e=this,void 0,r=function(){var e;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(n){switch(n.label){case 0:return e=this._getSalesBatch(),[4,this.saleDatabase.saveSales(e,t)];case 1:return n.sent(),this.cartProductsArray=[],this.cartProducts=Object(k.a)([]),this.customerFormControl.setValue(null),this._getTotal(0),this.eventService.broadcast(T.a.CART_ITEMS,[]),[2]}}))},new((n=void 0)||(n=Promise))((function(t,o){function i(t){try{c(r.next(t))}catch(e){o(e)}}function a(t){try{c(r.throw(t))}catch(e){o(e)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(i,a)}c((r=r.apply(e,[])).next())}));var e,n,r},t.prototype.printCart=function(){var t=this;this.checkoutProgress=!0;var e=R.a.generateUUID(),n=this._getCartItems();this.printer.print({data:this.cartItemsToPrinterData(n,this.isViewedInWholesale?this.customerFormControl.value:null),printer:E.a.android?"jzv3":"tm20",id:e,qr:e}).then((function(n){return t.submitBill(e)})).then((function(e){t.checkoutProgress=!1,t.snack.open("Done save sales","Ok",{duration:2e3})})).catch((function(e){t.checkoutProgress=!1,t.snack.open(e&&e.message?e.message:e.toString(),"Ok",{duration:3e3})}))},t.prototype.cartItemsToPrinterData=function(e,n){var r=this,o="";o=(o=o.concat("-------------------------------\n")).concat((new Date).toDateString()+"\n"),n&&(o=o.concat("-------------------------------\nTo ---\x3e "+n));var i=0;return e.forEach((function(e,n){i+=e.amount,o=o.concat("\n-------------------------------\n"+(n+1)+".  "+e.product+"\nQuantity --\x3e "+t.getQuantity(r.isViewedInWholesale,e)+" "+e.stock.unit+" \tUnit Price --\x3e "+t.getPrice(r.isViewedInWholesale,e)+"\tSub Amount  --\x3e "+e.amount+" \t")})),o=o.concat("\n--------------------------------\nTotal Bill : "+i+"\n--------------------------------\n")},t.prototype._getCartItems=function(){var e=this;return this.cartProductsArray.map((function(n){return{amount:e._getCartItemSubAmount({totalItems:e.cartProductsArray.length,totalDiscount:e.discountFormControl.value,product:n.product,quantity:n.quantity}),product:n.product.product,quantity:n.quantity,stock:n.product,discount:t._getCartItemDiscount({totalItems:e.cartProductsArray.length,totalDiscount:e.discountFormControl.value})}}))},t.prototype._getSalesBatch=function(){var e=this,n=Object(U.a)(new Date),r=this.isViewedInWholesale?"whole":"retail",o=[];return this.cartProductsArray.forEach((function(i){var a;o.push({amount:e._getCartItemSubAmount({totalItems:e.cartProductsArray.length,totalDiscount:e.discountFormControl.value,product:i.product,quantity:i.quantity}),discount:t._getCartItemDiscount({totalItems:e.cartProductsArray.length,totalDiscount:e.discountFormControl.value}),quantity:e.isViewedInWholesale?i.quantity*i.product.wholesaleQuantity:i.quantity,product:i.product.product,category:i.product.category,unit:i.product.unit,channel:r,date:n,idTra:"n",customer:e.isViewedInWholesale?e.customerFormControl.value:null,user:null===(a=e.currentUser)||void 0===a?void 0:a.id,stock:i.product,stockId:i.product.id})})),o},t.prototype._getCustomers=function(){var t=this;this.isViewedInWholesale&&this.customerApi.getCustomers().then((function(e){e||(e=[]),t.customers=Object(k.a)(e.map((function(t){return t.displayName})))})).catch()},t.\u0275fac=function(e){return new(e||t)(x.Mb(B.a),x.Mb(F),x.Mb(N.a),x.Mb(G),x.Mb(C.a),x.Mb(W),x.Mb(D.a))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-cart"]],inputs:{isViewedInWholesale:"isViewedInWholesale",cartdrawer:"cartdrawer"},features:[x.Ab([F,N.a])],decls:32,vars:18,consts:[["id","cart_view",3,"ngClass"],[1,"mat-elevation-z3",2,"z-index","10000"],["matBadgeOverlap","false",3,"matBadge"],[2,"flex-grow","1"],["mat-icon-button","",2,"float","right",3,"click"],["style","padding: 5px 0 0 0",4,"ngIf"],[2,"margin-bottom","300px"],[4,"ngFor","ngForOf"],[2,"padding","8px 8px 16px 8px","bottom","0","width","100%","position","absolute","background-color","white","z-index","1000"],[2,"margin-bottom","7px"],[1,"cart-total"],[2,"display","flex"],[2,"color","#868688","display","flex"],["autocomplete","false","type","number","min","0",2,"border","none","text-align","center","background-color","rgba(0, 170, 7, 0.1)","border-radius","4px","width","125px","height","35px",3,"formControl"],["color","primary","mat-raised-button","",2,"width","100%","text-align","left","height","54px","font-size","20px",3,"disabled","click"],[4,"ngIf"],["color","primary","mode","indeterminate","diameter","25","style","display: inline-block",4,"ngIf"],[2,"float","right"],[2,"padding","5px 0 0 0"],[2,"width","100%","padding","6px"],["autocomplete","false","placeholder","Customer Name","type","text",2,"border","none","background-color","rgba(0, 170, 7, 0.1)","padding","4px","border-radius","4px","width","100%","height","48px",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["matSuffix","","mat-icon-button","",3,"click"],["color","warn"],["matLine",""],["matLine","",1,"d-flex","flex-row"],["color","primary","mat-icon-button","",3,"click"],[2,"margin-left","5%","margin-right","5%"],["color","primary","mode","indeterminate","diameter","25",2,"display","inline-block"]],template:function(t,e){1&t&&(x.Sb(0,"div",0),x.Sb(1,"mat-toolbar",1),x.Sb(2,"span",2),x.Ec(3,"Cart"),x.Rb(),x.Nb(4,"span",3),x.Sb(5,"button",4),x.Zb("click",(function(){return e.cartdrawer.toggle()})),x.Sb(6,"mat-icon"),x.Ec(7,"close"),x.Rb(),x.Rb(),x.Rb(),x.Cc(8,X,7,5,"div",5),x.Sb(9,"div",6),x.Sb(10,"mat-list"),x.Cc(11,Y,18,8,"div",7),x.ec(12,"async"),x.Rb(),x.Rb(),x.Sb(13,"div",8),x.Nb(14,"mat-divider",9),x.Sb(15,"div",10),x.Sb(16,"h6",11),x.Sb(17,"span",3),x.Ec(18,"Total"),x.Rb(),x.Sb(19,"span"),x.Ec(20),x.ec(21,"currency"),x.Rb(),x.Rb(),x.Sb(22,"p",12),x.Sb(23,"span",3),x.Ec(24,"Discount( TZS )"),x.Rb(),x.Nb(25,"input",13),x.Rb(),x.Rb(),x.Sb(26,"button",14),x.Zb("click",(function(){return e.checkout()})),x.Cc(27,tt,2,0,"span",15),x.Cc(28,et,1,0,"mat-progress-spinner",16),x.Sb(29,"span",17),x.Ec(30),x.ec(31,"currency"),x.Rb(),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.jc("ngClass",e.isMobile?"cart-mobile":"cart"),x.Bb(2),x.jc("matBadge",e.getTotalCartItem().toString()),x.Bb(6),x.jc("ngIf",e.isViewedInWholesale),x.Bb(3),x.jc("ngForOf",x.fc(12,10,e.cartProducts)),x.Bb(9),x.Fc(x.gc(21,12,e.totalCost,"TZS ")),x.Bb(5),x.jc("formControl",e.discountFormControl),x.Bb(1),x.jc("disabled",e.checkoutProgress),x.Bb(1),x.jc("ngIf",!e.checkoutProgress),x.Bb(1),x.jc("ngIf",e.checkoutProgress),x.Bb(2),x.Fc(x.gc(31,15,e.totalCost,"TZS ")))},directives:[r.l,z.a,K.a,i.a,l.a,r.n,H.a,r.m,s.a,w.s,w.c,w.o,w.g,o.c,o.a,$.n,H.c,u.h,$.k,a.g,b.a],pipes:[r.b,r.d,r.g],styles:[".row[_ngcontent-%COMP%]{margin:2px}.product-card-image[_ngcontent-%COMP%]{background:#c4c4c4;width:30px;height:60px}.prod[_ngcontent-%COMP%]{font-size:14px}.cart-total[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:8px;font-family:Roboto,Helvetica Neue,sans-serif}h4[_ngcontent-%COMP%]{margin-bottom:0}.cart-products[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;padding:8px;align-items:center}.cart-products-image[_ngcontent-%COMP%]{width:60px;height:60px;flex-grow:0;border-radius:4px}.cart-product-title[_ngcontent-%COMP%]{white-space:normal;text-overflow:ellipsis;color:#000;font-size:14px;margin:0 auto}.cart-products-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{cursor:pointer}.cart[_ngcontent-%COMP%]{height:100vh;width:380px}.cart-mobile[_ngcontent-%COMP%]{height:100vh;width:100vw}mat-toolbar[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:0;z-index:1000}.cart-up-down[_ngcontent-%COMP%]{padding:0;font-size:56px}.cart-up-down[_ngcontent-%COMP%]:hover{cursor:pointer}.mat-badge-medium.mat-badge-above[_ngcontent-%COMP%]   .mat-badge-content[_ngcontent-%COMP%]{top:5px;margin-right:-5px}"]}),t}(),ot=n("eQIs"),it=function(){function t(){}return t.prototype.findTotalCartCost=function(t,e){var n=this;return e?t.map((function(t){return t.quantity*t.product.wholesaleQuantity*n.findCartItemUnitPrice(t,e)})).reduce((function(t,e){return t+e}),0):t.map((function(t){return t.quantity*t.product.retailPrice})).reduce((function(t,e){return t+e}),0)},t.prototype.findCartItemUnitPrice=function(t,e){return e?t.product.wholesalePrice/t.product.wholesaleQuantity:t.product.retailPrice},t.prototype.findTotalCartItem=function(t){return t.map((function(t){return t.quantity})).reduce((function(t,e){return t+e}),0)},t.prototype.findCartItemAmount=function(t,e){return e?this.findCartItemUnitPrice(t,e)*t.quantity*t.product.wholesaleQuantity:t.quantity*t.product.retailPrice},t.prototype.findCartItemQuantity=function(t,e){return e?t.quantity*t.product.wholesaleQuantity:t.quantity},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac=function(e){return new(e||t)}}),t}(),at=(nt=function(t,e){return(nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}nt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});function ct(t,e){if(1&t){var n=x.Tb();x.Sb(0,"div",1),x.Sb(1,"button",2),x.Zb("click",(function(){return x.tc(n),x.dc().showMainCart()})),x.Ec(2),x.ec(3,"number"),x.ec(4,"async"),x.ec(5,"currency"),x.Rb(),x.Rb()}if(2&t){var r=x.dc();x.jc("ngClass",r.isMobile?"fixed-bottom":r.enoughWidth()?"fixed-bottom-web":"fixed-bottom-web-enough-width"),x.Bb(2),x.Hc(" ",x.fc(3,3,x.fc(4,5,r.totalItems))," Items = ",x.gc(5,7,r.totalCost,"TZS ")," ")}}var st=function(t){function e(e,n,r){var o=t.call(this)||this;return o.eventApi=e,o.changeDetectorRef=n,o._saleUtils=r,o.totalCost=0,o.totalItems=Object(k.a)(0),o.isWholeSale=!1,o.isMobile=E.a.android,o}return at(e,t),e.prototype.ngOnInit=function(){this._cartEventsListen(),this._clearCartListener()},e.prototype._cartEventsListen=function(){var t=this;this.eventApi.listen(T.a.CART_ITEMS,(function(e){e&&e.detail?t._findTotalCost(e.detail):console.warn("unknown event")}))},e.prototype._findTotalCost=function(t){this.totalCost=this._saleUtils.findTotalCartCost(t,this.isWholeSale)},e.prototype.showMainCart=function(){this.cartSidenav.opened=!0},e.prototype._clearCartListener=function(){var t=this;this.eventApi.listen(T.a.NO_OF_CART,(function(e){t.totalItems=Object(k.a)(e.detail),t.changeDetectorRef.detectChanges()}))},e.\u0275fac=function(t){return new(t||e)(x.Mb(B.a),x.Mb(x.h),x.Mb(it))},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-cart-preview"]],inputs:{isWholeSale:"isWholeSale",cartSidenav:"cartSidenav"},features:[x.Ab([it]),x.yb],decls:2,vars:3,consts:[["style","padding: 16px",3,"ngClass",4,"ngIf"],[2,"padding","16px",3,"ngClass"],["mat-flat-button","","color","primary",1,"ft-button","btn-block",3,"click"]],template:function(t,e){1&t&&(x.Cc(0,ct,6,10,"div",0),x.ec(1,"async")),2&t&&x.jc("ngIf",x.fc(1,1,e.totalItems)>0)},directives:[r.n,r.l,i.a],pipes:[r.b,r.g,r.d],styles:[".fixed-bottom-web-enough-width[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:center;align-items:center}.fixed-bottom-web-enough-width[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:350px}.fixed-bottom-web[_ngcontent-%COMP%]{display:none}"]}),e}(M.a);function ut(t,e){if(1&t){var n=x.Tb();x.Sb(0,"div",1),x.Nb(1,"img",2),x.Sb(2,"h4"),x.Ec(3,"No Data"),x.Rb(),x.Sb(4,"button",3),x.Zb("click",(function(){return x.tc(n),x.dc().callBack()})),x.Sb(5,"mat-icon",4),x.Ec(6," refresh "),x.Rb(),x.Rb(),x.Rb()}}function lt(t,e){1&t&&(x.Sb(0,"div",1),x.Nb(1,"img",5),x.Sb(2,"h4"),x.Ec(3,"Fetching data..."),x.Rb(),x.Nb(4,"mat-progress-spinner",6),x.Rb()),2&t&&(x.Bb(4),x.jc("diameter",30))}var dt=function(){function t(){this.refreshCallback=new x.o}return t.prototype.ngOnInit=function(){},t.prototype.callBack=function(){this.refreshCallback.emit()},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-on-fetch"]],inputs:{isLoading:"isLoading"},outputs:{refreshCallback:"refreshCallback"},decls:2,vars:2,consts:[["class","no-data-wrapper",4,"ngIf"],[1,"no-data-wrapper"],["src","/src/assets/img/empty.svg","width","200px","alt",""],["matTooltip","Click to refresh","mat-raised-button","","mat-icon-button","",3,"click"],["color","accent"],["src","/src/assets/img/data.svg","width","200px","alt",""],["color","accent","mode","indeterminate",3,"diameter"]],template:function(t,e){1&t&&(x.Cc(0,ut,7,0,"div",0),x.Cc(1,lt,5,1,"div",0)),2&t&&(x.jc("ngIf",!e.isLoading),x.Bb(1),x.jc("ngIf",e.isLoading))},directives:[r.n,i.a,y.a,l.a,b.a],styles:[".no-data-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin-top:48px}.no-data-wrapper[_ngcontent-%COMP%] > h4[_ngcontent-%COMP%]{padding:8px}"]}),t}(),pt=n("vxfF"),bt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function ht(t,e){if(1&t){var n=x.Tb();x.Sb(0,"mat-card",7),x.Sb(1,"mat-card-content"),x.Sb(2,"button",8),x.Zb("click",(function(){return x.tc(n),x.dc().flipped=null})),x.Sb(3,"mat-icon"),x.Ec(4,"close"),x.Rb(),x.Rb(),x.Sb(5,"p"),x.Sb(6,"span",5),x.Ec(7),x.ec(8,"currency"),x.Rb(),x.Nb(9,"br"),x.Sb(10,"span",3),x.Ec(11),x.Rb(),x.Rb(),x.Sb(12,"p",9),x.Sb(13,"label",10),x.Ec(14,"Qty"),x.Rb(),x.Sb(15,"span",9),x.Sb(16,"button",11),x.Zb("click",(function(){return x.tc(n),x.dc().decrementQty()})),x.Sb(17,"mat-icon"),x.Ec(18,"remove_circle"),x.Rb(),x.Rb(),x.Nb(19,"input",12),x.Sb(20,"button",11),x.Zb("click",(function(){return x.tc(n),x.dc().incrementQty()})),x.Sb(21,"mat-icon"),x.Ec(22,"add_circle"),x.Rb(),x.Rb(),x.Rb(),x.Sb(23,"button",13),x.Zb("click",(function(){x.tc(n);var t=x.dc();return t.addToCart(t.product)})),x.Ec(24,"Add"),x.Rb(),x.Rb(),x.Rb(),x.Rb()}if(2&t){var r=x.dc();x.Bb(7),x.Gc(" ",x.gc(8,3,r.isViewedInWholesale?r.product.wholesalePrice:r.product.retailPrice,"TZS ")," "),x.Bb(4),x.Fc(r.product.product),x.Bb(8),x.jc("formControl",r.quantityFormControl)}}var ft=function(t){return{flipped:t}},mt=function(t){function e(e,n){var r=t.call(this)||this;return r.eventService=e,r.snack=n,r.isViewedInWholesale=!1,r.detailView=!1,r.quantityFormControl=new w.f(1,[w.v.nullValidator,w.v.min(1)]),r}return bt(e,t),e.prototype.ngOnInit=function(){},e.prototype.flip=function(t){var e=this;this.eventService.listen("flipping",(function(t){e.flipped=t.detail})),this.eventService.broadcast("flipping",t)},e.prototype.decrementQty=function(){this.quantityFormControl.value>0&&this.quantityFormControl.setValue(this.quantityFormControl.value-1)},e.prototype.incrementQty=function(){this.quantityFormControl.setValue(this.quantityFormControl.value+1)},e.prototype.addToCart=function(t){this.quantityFormControl.valid?(this.eventService.broadcast(T.a.ADD_CART,{product:t,quantity:this.quantityFormControl.value}),this.enoughWidth()&&(this.cartdrawer.opened=!0),this.quantityFormControl.reset(1),this.detailView=!1,this.flipped=null):this.snack.open("Quantity must be greater than 1","Ok",{duration:3e3,verticalPosition:"top"})},e.\u0275fac=function(t){return new(t||e)(x.Mb(B.a),x.Mb(D.a))},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-product-card"]],inputs:{product:"product",productIndex:"productIndex",isViewedInWholesale:"isViewedInWholesale",cartdrawer:"cartdrawer"},features:[x.yb],decls:13,vars:14,consts:[[1,"card-container",3,"ngClass"],[1,"flippable-card",3,"ngClass"],[1,"front",2,"text-align","center","width","150px","height","160px",3,"click"],[2,"color","gray"],[2,"font-weight","bold","overflow","hidden","height","46px",3,"matTooltip"],[2,"font-weight","500"],["class","back",4,"ngIf"],[1,"back"],["mat-icon-button","",2,"margin","0","padding","0","float","right",3,"click"],[2,"display","flex","flex-direction","row"],[2,"padding-top","10px"],["mat-icon-button","","color","primary",3,"click"],["autocomplete","false","type","number","min","1",2,"border","none","text-align","center","background-color","rgba(0, 170, 7, 0.1)","border-radius","4px","width","50%",3,"formControl"],["mat-flat-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(x.Sb(0,"div"),x.Sb(1,"div",0),x.Sb(2,"div",1),x.Sb(3,"mat-card",2),x.Zb("click",(function(){return e.flip(e.productIndex)})),x.Sb(4,"mat-card-content"),x.Sb(5,"p",3),x.Ec(6),x.Rb(),x.Sb(7,"p",4),x.Ec(8),x.Rb(),x.Sb(9,"p",5),x.Ec(10),x.ec(11,"currency"),x.Rb(),x.Rb(),x.Rb(),x.Cc(12,ht,25,6,"mat-card",6),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.Bb(1),x.jc("ngClass",x.mc(10,ft,e.productIndex==e.flipped)),x.Bb(1),x.jc("ngClass",x.mc(12,ft,e.productIndex==e.flipped)),x.Bb(4),x.Fc(e.product.category),x.Bb(1),x.kc("matTooltip",e.product.product),x.Bb(1),x.Fc(e.product.product),x.Bb(2),x.Gc(" ",x.gc(11,7,e.isViewedInWholesale?e.product.wholesalePrice:e.product.retailPrice,"TZS ")," "),x.Bb(2),x.jc("ngIf",e.productIndex===e.flipped))},directives:[r.l,a.a,a.c,y.a,r.n,i.a,l.a,w.s,w.c,w.o,w.g],pipes:[r.d],styles:[".card-container[_ngcontent-%COMP%]{width:135px;height:160px;margin:0 7px;position:relative;transition:width .2s}.flippable-card[_ngcontent-%COMP%]{position:relative;transform-style:preserve-3d;transition:transform .5s}.flippable-card[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin:0;display:block;position:absolute;width:132px;min-height:150px;-webkit-backface-visibility:hidden;backface-visibility:hidden}.flippable-card[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{background:#fff;width:326px;height:160px}.flippable-card[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%], .flippable-card.flipped[_ngcontent-%COMP%]{transform:rotateY(180deg)}.card-container.flipped[_ngcontent-%COMP%]{width:326px}"]}),e}(M.a),gt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vt=["sidenav"];function yt(t,e){if(1&t){var n=x.Tb();x.Sb(0,"smartstock-on-fetch",14),x.Zb("refreshCallback",(function(){return x.tc(n),x.dc().getProductsFromServer()})),x.Rb()}if(2&t){var r=x.dc();x.jc("isLoading",r.fetchDataProgress)}}function wt(t,e){if(1&t&&x.Nb(0,"smartstock-product-card",17),2&t){var n=e.$implicit,r=e.index,o=x.dc(2),i=x.pc(5);x.jc("cartdrawer",i)("product",n)("productIndex",r)("isViewedInWholesale",o.isViewedInWholesale)}}function Ct(t,e){if(1&t&&(x.Sb(0,"cdk-virtual-scroll-viewport",15),x.Cc(1,wt,1,4,"smartstock-product-card",16),x.Rb()),2&t){var n=x.dc();x.Bb(1),x.jc("cdkVirtualForOf",n.products)}}function St(t,e){if(1&t){var n=x.Tb();x.Sb(0,"button",18),x.Zb("click",(function(){return x.tc(n),x.dc().getProductsFromServer()})),x.Sb(1,"mat-icon"),x.Ec(2,"refresh"),x.Rb(),x.Rb()}}var kt=function(){return{flex:"1 1 auto"}},_t=function(){return{}},Pt=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this)||this;return s.router=e,s.userDatabase=n,s.storage=r,s.snack=o,s.logger=i,s.eventApi=a,s.salesState=c,s.products=void 0,s.fetchDataProgress=!1,s.showProgress=!1,s.searchProgressFlag=!1,s.isViewedInWholesale=!0,s.isMobile=E.a.android,s.noOfProductsInCart=1,s.searchInputControl=new w.f(""),s.showRefreshCart=!1,s}return gt(e,t),e.prototype.ngOnInit=function(){var t=this;this.getProducts(),this._addToCartEventListener(),this.eventApi.listen(T.a.NO_OF_CART,(function(e){t.showRefreshCart=0===e.detail}))},e.prototype.getProductsFromServer=function(){var t=this;this.fetchDataProgress=!0,this.salesState.getAllStock().then((function(e){t.fetchDataProgress=!1,t.products=e})).catch((function(e){t.fetchDataProgress=!1,t.logger.i(e)}))},e.prototype.getProducts=function(){var t=this;this.fetchDataProgress=!0,this.products=void 0,this.storage.getStocks().then((function(e){t.fetchDataProgress=!1,e&&e.length>0&&(t.products=e)})).catch((function(e){t.fetchDataProgress=!1,t.logger.i(e)}))},e.prototype.filterProduct=function(t){var e=this;if(t=t.trim(),this.searchProgressFlag=!0,""===t)return this.getProducts(),void(this.searchProgressFlag=!1);this.storage.getStocks().then((function(n){e.searchProgressFlag=!1,n?e.products=n.filter((function(e){return e.product.toLowerCase().trim().includes(t.trim().toLowerCase())})):e.snack.open("No products found, try again or refresh products","Ok",{duration:3e3})})).catch((function(t){e.searchProgressFlag=!1,e.logger.i(t),e.snack.open(t,"Ok")}))},e.prototype._addToCartEventListener=function(){var t=this;this.eventApi.listen(T.a.ADD_CART,(function(e){t.searchInputControl.setValue("")}))},e.\u0275fac=function(t){return new(t||e)(x.Mb(j.b),x.Mb(C.a),x.Mb(S.a),x.Mb(D.a),x.Mb(_.a),x.Mb(B.a),x.Mb(F))},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-sale"]],viewQuery:function(t,e){var n;1&t&&x.Jc(vt,!0),2&t&&x.oc(n=x.ac())&&(e.sidenav=n.first)},inputs:{isViewedInWholesale:"isViewedInWholesale"},features:[x.Ab([F,C.a]),x.yb],decls:15,vars:24,consts:[[1,"match-parent"],[1,"match-parent-side",3,"mode","opened"],["sidenav",""],["position","end",3,"fixedInViewport","mode","opened"],["cartdrawer",""],[3,"isViewedInWholesale","cartdrawer"],[2,"display","flex","flex-direction","column"],["searchPlaceholder","Filter product",3,"showSearch","hasBackRoute","backLink","searchInputControl","searchProgressFlag","heading","sidenav","cartdrawer","showProgress","searchCallback"],[3,"isLoading","refreshCallback",4,"ngIf"],["style","flex-grow: 1","itemSize","25",4,"ngIf"],[2,"position","fixed","width","100%","display","flex","flex-direction","row","justify-content","center","align-items","center","z-index","3000","left","16px","bottom","20px"],["mat-button","","color","primary","matTooltip","Refresh products from server","class","mat-fab",3,"click",4,"ngIf"],[3,"ngStyle"],[3,"cartSidenav","isWholeSale"],[3,"isLoading","refreshCallback"],["itemSize","25",2,"flex-grow","1"],["style","margin: 0 5px; display: inline-block",3,"cartdrawer","product","productIndex","isViewedInWholesale",4,"cdkVirtualFor","cdkVirtualForOf"],[2,"margin","0 5px","display","inline-block",3,"cartdrawer","product","productIndex","isViewedInWholesale"],["mat-button","","color","primary","matTooltip","Refresh products from server",1,"mat-fab",3,"click"]],template:function(t,e){if(1&t&&(x.Sb(0,"mat-sidenav-container",0),x.Sb(1,"mat-sidenav",1,2),x.Nb(3,"smartstock-admin-drawer"),x.Rb(),x.Sb(4,"mat-sidenav",3,4),x.Nb(6,"smartstock-cart",5),x.Rb(),x.Sb(7,"mat-sidenav-content",6),x.Sb(8,"smartstock-toolbar",7),x.Zb("searchCallback",(function(t){return e.filterProduct(t)})),x.Rb(),x.Cc(9,yt,1,1,"smartstock-on-fetch",8),x.Cc(10,Ct,2,1,"cdk-virtual-scroll-viewport",9),x.Sb(11,"div",10),x.Cc(12,St,3,0,"button",11),x.Nb(13,"span",12),x.Nb(14,"smartstock-cart-preview",13),x.Rb(),x.Rb(),x.Rb()),2&t){var n=x.pc(2),r=x.pc(5);x.Bb(1),x.jc("mode","over")("opened",!1),x.Bb(3),x.jc("fixedInViewport",!1)("mode",e.enoughWidth()?"side":"over")("opened",!1),x.Bb(2),x.jc("isViewedInWholesale",e.isViewedInWholesale)("cartdrawer",r),x.Bb(2),x.jc("showSearch",!0)("hasBackRoute",!0)("backLink","/sale/")("searchInputControl",e.searchInputControl)("searchProgressFlag",e.searchProgressFlag)("heading",e.isViewedInWholesale?"WholeSale":"Retail")("sidenav",n)("cartdrawer",r)("showProgress",e.showProgress),x.Bb(1),x.jc("ngIf",!e.products||e.fetchDataProgress),x.Bb(1),x.jc("ngIf",e.products&&!e.fetchDataProgress),x.Bb(2),x.jc("ngIf",!e.fetchDataProgress&&e.products&&e.showRefreshCart),x.Bb(1),x.jc("ngStyle",e.showRefreshCart?x.lc(22,kt):x.lc(23,_t)),x.Bb(1),x.jc("cartSidenav",r)("isWholeSale",e.isViewedInWholesale)}},directives:[h.b,h.a,A.a,rt,h.c,ot.a,r.n,r.o,st,dt,pt.e,pt.a,pt.d,mt,i.a,y.a,l.a],styles:[""]}),e}(M.a),Rt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=["sidenav"],It=function(t){function e(e,n,r,o,i,a){var c=t.call(this)||this;return c.router=e,c.userDatabase=n,c._storage=r,c.snack=o,c.logger=i,c.salesState=a,c.fetchDataProgress=!1,c.showProgress=!1,c.searchProgressFlag=!1,c.isViewedInWholesale=!1,c}return Rt(e,t),e.prototype.ngOnInit=function(){this.getProducts()},e.prototype.getProductsFromServer=function(){var t=this;this.fetchDataProgress=!0,this.productsObservable=void 0,this.salesState.getAllStock().then((function(e){t.fetchDataProgress=!1,t.productsObservable=Object(k.a)(e)})).catch((function(e){t.fetchDataProgress=!1,t.logger.i(e)}))},e.prototype.getProducts=function(){var t=this;this.fetchDataProgress=!0,this.productsObservable=void 0,this._storage.getStocks().then((function(e){t.fetchDataProgress=!1,t.productsObservable=Object(k.a)(e)})).catch((function(e){t.fetchDataProgress=!1,t.logger.i(e)}))},e.prototype.filterProduct=function(t){var e=this;if(this.searchProgressFlag=!0,""===t)return this.getProducts(),void(this.searchProgressFlag=!1);this._storage.getStocks().then((function(n){if(e.searchProgressFlag=!1,n){var r=n.filter((function(e){return e.product.toLowerCase().includes(t.toLowerCase())}));e.productsObservable=Object(k.a)(r.slice(0,r.length>50?50:r.length))}else e.snack.open("No products found, try again or refresh products","Ok",{duration:3e3})})).catch((function(t){e.searchProgressFlag=!1,e.logger.i(t),e.snack.open(t,"Ok")}))},e.\u0275fac=function(t){return new(t||e)(x.Mb(j.b),x.Mb(C.a),x.Mb(S.a),x.Mb(D.a),x.Mb(_.a),x.Mb(F))},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-retail-sale"]],viewQuery:function(t,e){var n;1&t&&x.Jc(xt,!0),2&t&&x.oc(n=x.ac())&&(e.sidenav=n.first)},inputs:{isViewedInWholesale:"isViewedInWholesale"},features:[x.yb],decls:1,vars:1,consts:[[3,"isViewedInWholesale"]],template:function(t,e){1&t&&x.Nb(0,"smartstock-sale",0),2&t&&x.jc("isViewedInWholesale",!1)},directives:[Pt],styles:[""]}),e}(M.a),Ot=function(){function t(){}return t.prototype.ngOnInit=function(){},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-whole-sale"]],decls:1,vars:1,consts:[[3,"isViewedInWholesale"]],template:function(t,e){1&t&&x.Nb(0,"smartstock-sale",0),2&t&&x.jc("isViewedInWholesale",!0)},directives:[Pt],styles:[".space[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px}.example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.full-width[_ngcontent-%COMP%]{width:100%}.example-option-img[_ngcontent-%COMP%]{vertical-align:middle;margin-right:8px}[dir=rtl][_ngcontent-%COMP%]   .example-option-img[_ngcontent-%COMP%]{margin-right:0;margin-left:8px}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.dawer-head[_ngcontent-%COMP%]{height:30vh;background-image:url(/assets/img/calculate.jpg);background-repeat:no-repeat;background-position:50%;background-size:cover}table[_ngcontent-%COMP%]{width:100%}.wholesale-container[_ngcontent-%COMP%]{padding-left:24px;padding-right:24px}"]}),t}(),Ft=n("Ktec"),Mt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function jt(t,e){if(1&t&&(x.Sb(0,"div",7),x.Sb(1,"mat-card",8),x.Sb(2,"mat-icon",9),x.Ec(3),x.Rb(),x.Rb(),x.Sb(4,"p"),x.Ec(5),x.Rb(),x.Rb()),2&t){var n=e.$implicit;x.kc("routerLink",n.path),x.Bb(3),x.Gc(" ",n.icon," "),x.Bb(2),x.Fc(n.name)}}var Dt=function(t){function e(){var e=t.call(this)||this;return e.pages=[{name:"Retail",path:"/sale/retail",icon:"receipt"},{name:"Wholesale",path:"/sale/whole",icon:"widgets"}],e}return Mt(e,t),e.prototype.ngOnInit=function(){},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-sales-index"]],features:[x.yb],decls:11,vars:5,consts:[[1,"match-parent-side",3,"mode","opened"],["sidenav",""],[2,"min-height","100vh"],["searchPlaceholder","Filter product",3,"heading","sidenav"],[1,"container","col-xl-10","col-lg-10","col-sm-9","col-md-9","col-sm-12","col-10",2,"padding","16px 0"],[1,"row"],["style","margin: 5px; cursor: pointer",3,"routerLink",4,"ngFor","ngForOf"],[2,"margin","5px","cursor","pointer",3,"routerLink"],["matRipple","",2,"width","150px","height","150px","display","flex","justify-content","center","align-items","center","flex-direction","column"],["color","primary",2,"font-size","60px","height","60px","width","60px"]],template:function(t,e){if(1&t&&(x.Sb(0,"mat-sidenav-container"),x.Sb(1,"mat-sidenav",0,1),x.Nb(3,"smartstock-admin-drawer"),x.Rb(),x.Sb(4,"mat-sidenav-content",2),x.Nb(5,"smartstock-toolbar",3),x.Sb(6,"div",4),x.Sb(7,"h1"),x.Ec(8,"Go To"),x.Rb(),x.Sb(9,"div",5),x.Cc(10,jt,6,3,"div",6),x.Rb(),x.Rb(),x.Rb(),x.Rb()),2&t){var n=x.pc(2);x.Bb(1),x.jc("mode",e.enoughWidth()?"side":"over")("opened",e.enoughWidth()),x.Bb(4),x.jc("heading","Sales")("sidenav",n),x.Bb(5),x.jc("ngForOf",e.pages)}},directives:[h.b,h.a,A.a,h.c,ot.a,r.m,j.c,a.a,$.s,l.a],encapsulation:2}),e}(M.a),Et=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},Bt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Tt=function(){function t(t){this.storageService=t}return t.prototype.getOrders=function(t,e){return void 0===t&&(t=20),void 0===e&&(e=0),Et(this,void 0,void 0,(function(){var n;return Bt(this,(function(r){switch(r.label){case 0:return[4,this.storageService.getActiveShop()];case 1:return n=r.sent(),[4,P.BFast.database(n.projectId).collection("orders").query().skip(e).size(t).orderBy("_created_at",-1).find()];case 2:return[2,r.sent().map((function(t){return t.displayName=t.user.displayName,t}))]}}))}))},t.prototype.markOrderIsPaid=function(t){return Et(this,void 0,void 0,(function(){return Bt(this,(function(e){return[2,P.BFast.database().collection("orders").query().byId(t).updateBuilder().set("paid",!0).update()]}))}))},t.prototype.checkOrderIsPaid=function(t){return Et(this,void 0,void 0,(function(){return Bt(this,(function(e){switch(e.label){case 0:return[4,P.BFast.functions("fahamupay").request("/functions/pay/check/"+t).get()];case 1:return[2,e.sent().map((function(t){return Math.round(Number(t.amount))})).reduce((function(t,e){return t+e}),0)]}}))}))},t.\u0275fac=function(e){return new(e||t)(x.Wb(S.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"any"}),t}(),At=n("2Vo4"),Nt=n("QVH4"),Wt=function(){function t(t,e,n){this.orderService=t,this.logger=e,this.messageService=n,this.orders=new At.a([]),this.orderFilterKeyword=new At.a(""),this.getOrderFlag=new At.a(!1)}return t.prototype.getOrder=function(t,e){var n=this;void 0===t&&(t=20),void 0===e&&(e=0),this.getOrderFlag.next(!0),this.orderService.getOrders(t,e).then((function(t){var e;(e=n.orders.value).push.apply(e,t),n.orders.next(n.orders.value)})).catch((function(t){n.logger.i(t),n.messageService.showMobileInfoMessage("Fails to fetch orders",2e3,"bottom")})).finally((function(){n.getOrderFlag.next(!1)}))},t.\u0275fac=function(e){return new(e||t)(x.Wb(Tt),x.Wb(_.a),x.Wb(Nt.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"any"}),t}(),Vt=n("2ChS");function Lt(t,e){if(1&t&&(x.Sb(0,"mat-list-item"),x.Sb(1,"h1",3),x.Ec(2),x.Rb(),x.Sb(3,"mat-card-subtitle",3),x.Ec(4),x.Rb(),x.Rb()),2&t){var n=e.$implicit;x.Bb(2),x.Fc(n.product.product),x.Bb(2),x.Gc("Quantity : ",n.quantity,"")}}var qt=function(){function t(t,e){this.bottomSheetRef=t,this.data=e}return t.prototype.ngOnInit=function(){},t.\u0275fac=function(e){return new(e||t)(x.Mb(Vt.d),x.Mb(Vt.a))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-orders-show-items"]],decls:12,vars:5,consts:[[2,"padding","16px 0 24px 0"],[4,"ngFor","ngForOf"],[2,"padding","8px 0 16px 0"],["matLine",""]],template:function(t,e){1&t&&(x.Sb(0,"div",0),x.Sb(1,"div"),x.Sb(2,"h3"),x.Ec(3,"Order Items"),x.Rb(),x.Rb(),x.Nb(4,"mat-divider"),x.Sb(5,"mat-list"),x.Cc(6,Lt,5,2,"mat-list-item",1),x.Rb(),x.Nb(7,"mat-divider"),x.Sb(8,"div",2),x.Sb(9,"h3"),x.Ec(10),x.ec(11,"currency"),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.Bb(6),x.jc("ngForOf",e.data.order.carts),x.Bb(4),x.Fc(x.gc(11,2,e.data.order.total,"TZS ")))},directives:[s.a,H.a,r.m,H.c,$.k,a.g],pipes:[r.d],encapsulation:2}),t}(),Qt=function(){function t(t,e,n){this.bottomSheetRef=t,this.bottomSheet=e,this.data=n}return t.prototype.ngOnInit=function(){},t.prototype.showItems=function(){this.bottomSheetRef.dismiss(!0),this.bottomSheet.open(qt,{data:{order:this.data.order},closeOnNavigation:!0})},t.prototype.markAsComplete=function(){},t.\u0275fac=function(e){return new(e||t)(x.Mb(Vt.d),x.Mb(Vt.b),x.Mb(Vt.a))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-orders-table-options"]],decls:23,vars:0,consts:[[2,"padding","16px 0 24px 0"],[3,"click"],["matListIcon",""],["matLine",""]],template:function(t,e){1&t&&(x.Sb(0,"div",0),x.Sb(1,"mat-nav-list"),x.Sb(2,"mat-list-item",1),x.Zb("click",(function(){return e.markAsComplete()})),x.Sb(3,"mat-icon",2),x.Ec(4,"done_all"),x.Rb(),x.Sb(5,"p",3),x.Ec(6,"Mark As Complete"),x.Rb(),x.Sb(7,"mat-card-subtitle",3),x.Ec(8,"Mark order as complete"),x.Rb(),x.Rb(),x.Sb(9,"mat-list-item",1),x.Zb("click",(function(){return e.showItems()})),x.Sb(10,"mat-icon",2),x.Ec(11,"receipt"),x.Rb(),x.Sb(12,"p",3),x.Ec(13,"Show Items"),x.Rb(),x.Sb(14,"mat-card-subtitle",3),x.Ec(15,"See orders items"),x.Rb(),x.Rb(),x.Sb(16,"mat-list-item"),x.Sb(17,"mat-icon",2),x.Ec(18,"print"),x.Rb(),x.Sb(19,"p",3),x.Ec(20,"Print Order"),x.Rb(),x.Sb(21,"mat-card-subtitle",3),x.Ec(22,"Get order in PDF"),x.Rb(),x.Rb(),x.Rb(),x.Rb())},directives:[H.e,H.c,l.a,H.b,$.k,a.g],encapsulation:2}),t}(),Zt=function(){function t(t){this.orderState=t}return t.prototype.ngOnInit=function(){},t.prototype.loadMore=function(){this.orderState.getOrder(20,this.orderState.orders.value.length)},t.prototype.clearFilter=function(){this.orderState.orderFilterKeyword.next("")},t.\u0275fac=function(e){return new(e||t)(x.Mb(Wt))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-orders-table-actions"]],decls:10,vars:6,consts:[[1,"row"],["color","primary","mat-flat-button","",1,"ft-button",3,"disabled","click"],[2,"margin","5px"],["color","primary","mat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(x.Sb(0,"div",0),x.Sb(1,"button",1),x.Zb("click",(function(){return e.loadMore()})),x.ec(2,"async"),x.Ec(3," Load More "),x.Rb(),x.Nb(4,"div",2),x.Sb(5,"button",3),x.Zb("click",(function(){return e.clearFilter()})),x.ec(6,"async"),x.Sb(7,"mat-icon"),x.Ec(8,"filter_alt"),x.Rb(),x.Ec(9," Clear Filter "),x.Rb(),x.Rb()),2&t&&(x.Bb(1),x.jc("disabled",!0===x.fc(2,2,e.orderState.getOrderFlag)),x.Bb(4),x.jc("disabled",""===x.fc(6,4,e.orderState.orderFilterKeyword)))},directives:[i.a,l.a],pipes:[r.b],encapsulation:2}),t}(),Gt=n("bv9b"),Ut=n("f6nW"),zt=n("Fprw"),Kt=(n("KQm4"),n("vuIU")),Ht=n("JX7q"),$t=n("Ji7U"),Jt=n("LK+K"),Xt=n("1OyB"),Yt=n("FtGj"),te=n("8LU1"),ee=n("R1ws"),ne=n("XNiG"),re=(n("VRyK"),n("IzEk")),oe=(n("1G5W"),n("JX91"),n("u47x"),n("0EQZ"),n("nLfN")),ie=(n("cH1L"),new x.s("MatChipRemove")),ae=new x.s("MatChipAvatar"),ce=new x.s("MatChipTrailingIcon"),se=function t(e){Object(Xt.a)(this,t),this._elementRef=e},ue=Object($.C)(Object($.x)(Object($.y)(se),"primary"),-1),le=function(){var t=function(t){Object($t.a)(n,t);var e=Object(Jt.a)(n);function n(t,r,o,i,a,c,s,u){var l;return Object(Xt.a)(this,n),(l=e.call(this,t))._elementRef=t,l._ngZone=r,l._changeDetectorRef=c,l._hasFocus=!1,l.chipListSelectable=!0,l._chipListMultiple=!1,l._chipListDisabled=!1,l._selected=!1,l._selectable=!0,l._disabled=!1,l._removable=!0,l._onFocus=new ne.a,l._onBlur=new ne.a,l.selectionChange=new x.o,l.destroyed=new x.o,l.removed=new x.o,l._addHostClassName(),l._chipRippleTarget=(u||document).createElement("div"),l._chipRippleTarget.classList.add("mat-chip-ripple"),l._elementRef.nativeElement.appendChild(l._chipRippleTarget),l._chipRipple=new $.u(Object(Ht.a)(l),r,l._chipRippleTarget,o),l._chipRipple.setupTriggerEvents(t),l.rippleConfig=i||{},l._animationsDisabled="NoopAnimations"===a,l.tabIndex=null!=s&&parseInt(s)||-1,l}return Object(Kt.a)(n,[{key:"_addHostClassName",value:function(){var t=this._elementRef.nativeElement;t.hasAttribute("mat-basic-chip")||"mat-basic-chip"===t.tagName.toLowerCase()?t.classList.add("mat-basic-chip"):t.classList.add("mat-standard-chip")}},{key:"ngOnDestroy",value:function(){this.destroyed.emit({chip:this}),this._chipRipple._removeTriggerEvents()}},{key:"select",value:function(){this._selected||(this._selected=!0,this._dispatchSelectionChange(),this._markForCheck())}},{key:"deselect",value:function(){this._selected&&(this._selected=!1,this._dispatchSelectionChange(),this._markForCheck())}},{key:"selectViaInteraction",value:function(){this._selected||(this._selected=!0,this._dispatchSelectionChange(!0),this._markForCheck())}},{key:"toggleSelected",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._selected=!this.selected,this._dispatchSelectionChange(t),this._markForCheck(),this.selected}},{key:"focus",value:function(){this._hasFocus||(this._elementRef.nativeElement.focus(),this._onFocus.next({chip:this})),this._hasFocus=!0}},{key:"remove",value:function(){this.removable&&this.removed.emit({chip:this})}},{key:"_handleClick",value:function(t){this.disabled?t.preventDefault():t.stopPropagation()}},{key:"_handleKeydown",value:function(t){if(!this.disabled)switch(t.keyCode){case Yt.c:case Yt.b:this.remove(),t.preventDefault();break;case Yt.n:this.selectable&&this.toggleSelected(!0),t.preventDefault()}}},{key:"_blur",value:function(){var t=this;this._ngZone.onStable.asObservable().pipe(Object(re.a)(1)).subscribe((function(){t._ngZone.run((function(){t._hasFocus=!1,t._onBlur.next({chip:t})}))}))}},{key:"_dispatchSelectionChange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.selectionChange.emit({source:this,isUserInput:t,selected:this._selected})}},{key:"_markForCheck",value:function(){this._changeDetectorRef&&this._changeDetectorRef.markForCheck()}},{key:"rippleDisabled",get:function(){return this.disabled||this.disableRipple||!!this.rippleConfig.disabled}},{key:"selected",get:function(){return this._selected},set:function(t){var e=Object(te.c)(t);e!==this._selected&&(this._selected=e,this._dispatchSelectionChange())}},{key:"value",get:function(){return void 0!==this._value?this._value:this._elementRef.nativeElement.textContent},set:function(t){this._value=t}},{key:"selectable",get:function(){return this._selectable&&this.chipListSelectable},set:function(t){this._selectable=Object(te.c)(t)}},{key:"disabled",get:function(){return this._chipListDisabled||this._disabled},set:function(t){this._disabled=Object(te.c)(t)}},{key:"removable",get:function(){return this._removable},set:function(t){this._removable=Object(te.c)(t)}},{key:"ariaSelected",get:function(){return this.selectable&&(this._chipListMultiple||this.selected)?this.selected.toString():null}}]),n}(ue);return t.\u0275fac=function(e){return new(e||t)(x.Mb(x.l),x.Mb(x.B),x.Mb(oe.a),x.Mb($.i,8),x.Mb(ee.a,8),x.Mb(x.h),x.Xb("tabindex"),x.Mb(r.e,8))},t.\u0275dir=x.Hb({type:t,selectors:[["mat-basic-chip"],["","mat-basic-chip",""],["mat-chip"],["","mat-chip",""]],contentQueries:function(t,e,n){var r;1&t&&(x.Fb(n,ae,!0),x.Fb(n,ce,!0),x.Fb(n,ie,!0)),2&t&&(x.oc(r=x.ac())&&(e.avatar=r.first),x.oc(r=x.ac())&&(e.trailingIcon=r.first),x.oc(r=x.ac())&&(e.removeIcon=r.first))},hostAttrs:["role","option",1,"mat-chip","mat-focus-indicator"],hostVars:14,hostBindings:function(t,e){1&t&&x.Zb("click",(function(t){return e._handleClick(t)}))("keydown",(function(t){return e._handleKeydown(t)}))("focus",(function(){return e.focus()}))("blur",(function(){return e._blur()})),2&t&&(x.Cb("tabindex",e.disabled?null:e.tabIndex)("disabled",e.disabled||null)("aria-disabled",e.disabled.toString())("aria-selected",e.ariaSelected),x.Eb("mat-chip-selected",e.selected)("mat-chip-with-avatar",e.avatar)("mat-chip-with-trailing-icon",e.trailingIcon||e.removeIcon)("mat-chip-disabled",e.disabled)("_mat-animation-noopable",e._animationsDisabled))},inputs:{color:"color",disableRipple:"disableRipple",tabIndex:"tabIndex",selected:"selected",value:"value",selectable:"selectable",disabled:"disabled",removable:"removable"},outputs:{selectionChange:"selectionChange",destroyed:"destroyed",removed:"removed"},exportAs:["matChip"],features:[x.yb]}),t}(),de=new x.s("mat-chips-default-options"),pe={separatorKeyCodes:[Yt.f]},be=function(){var t=function t(){Object(Xt.a)(this,t)};return t.\u0275mod=x.Kb({type:t}),t.\u0275inj=x.Jb({factory:function(e){return new(e||t)},providers:[$.d,{provide:de,useValue:pe}]}),t}();function he(t,e){if(1&t){var n=x.Tb();x.Sb(0,"button",3),x.Zb("click",(function(){return x.tc(n),x.dc().makePayment()})),x.Ec(1," PAY NOW "),x.Rb()}}function fe(t,e){1&t&&(x.Sb(0,"mat-chip",4),x.Ec(1," PAID "),x.Rb()),2&t&&x.jc("disableRipple",!0)}function me(t,e){1&t&&x.Nb(0,"mat-progress-spinner",5)}var ge=function(){function t(t,e,n){this.orderService=t,this.bottomSheet=e,this.logger=n,this.getPaidProgress=!1,this.isPaid=!1}return t.prototype.ngOnInit=function(){this.checkOrderStatus()},t.prototype.checkOrderStatus=function(){var t=this;!1===this.order.paid&&(this.getPaidProgress=!0,this.orderService.checkOrderIsPaid(this.order.id.split("-")[1]).then((function(e){t.getPaidProgress=!1,t.isPaid=e>=t.order.total,t.orderService.markOrderIsPaid(t.order.id).then(console.log).catch((function(t){}))})).catch((function(e){t.getPaidProgress=!1,t.logger.i(e)})))},t.prototype.makePayment=function(){var t=this;this.bottomSheet.open(zt.a,{data:{ref:this.order.id.split("-")[1],amount:this.order.total},closeOnNavigation:!1}).afterDismissed().subscribe((function(e){!0===e&&t.checkOrderStatus()}))},t.\u0275fac=function(e){return new(e||t)(x.Mb(Tt),x.Mb(Vt.b),x.Mb(_.a))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-oder-paid-status"]],inputs:{order:"order"},decls:3,vars:3,consts:[["mat-button","","color","primary",3,"click",4,"ngIf"],[3,"disableRipple",4,"ngIf"],["mode","indeterminate","diameter","30","color","primary",4,"ngIf"],["mat-button","","color","primary",3,"click"],[3,"disableRipple"],["mode","indeterminate","diameter","30","color","primary"]],template:function(t,e){1&t&&(x.Cc(0,he,2,0,"button",0),x.Cc(1,fe,2,1,"mat-chip",1),x.Cc(2,me,1,0,"mat-progress-spinner",2)),2&t&&(x.jc("ngIf",!e.isPaid&&!e.getPaidProgress),x.Bb(1),x.jc("ngIf",e.isPaid&&!e.getPaidProgress),x.Bb(1),x.jc("ngIf",e.getPaidProgress))},directives:[r.n,i.a,le,b.a],encapsulation:2}),t}(),ve=n("ZBrE");function ye(t,e){1&t&&x.Nb(0,"mat-progress-bar",5)}function we(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Date"),x.Rb())}function Ce(t,e){if(1&t&&(x.Sb(0,"td",19),x.Ec(1),x.ec(2,"date"),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.Fc(x.fc(2,1,n.createdAt))}}function Se(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Customer"),x.Rb())}function ke(t,e){if(1&t&&(x.Sb(0,"td",19),x.Ec(1),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.Fc(n.displayName)}}function _e(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Amount"),x.Rb())}function Pe(t,e){if(1&t&&(x.Sb(0,"td",19),x.Ec(1),x.ec(2,"currency"),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.Fc(x.gc(2,1,n.total,"TZS "))}}function Re(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Payment"),x.Rb())}function xe(t,e){if(1&t&&(x.Sb(0,"td",19),x.Nb(1,"smartstock-oder-paid-status",20),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.jc("order",n)}}function Ie(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Mobile"),x.Rb())}function Oe(t,e){if(1&t&&(x.Sb(0,"td",19),x.Ec(1),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.Fc(n.mobile)}}function Fe(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Status"),x.Rb())}function Me(t,e){1&t&&(x.Sb(0,"span"),x.Ec(1,"COMPLETED"),x.Rb())}function je(t,e){1&t&&(x.Sb(0,"span"),x.Ec(1,"NEW"),x.Rb())}function De(t,e){if(1&t&&(x.Sb(0,"td",19),x.Cc(1,Me,2,0,"span",21),x.Cc(2,je,2,0,"span",21),x.Rb()),2&t){var n=e.$implicit;x.Bb(1),x.jc("ngIf","DELIVERED"===n.status),x.Bb(1),x.jc("ngIf","PROCESSED"===n.status)}}function Ee(t,e){1&t&&(x.Sb(0,"th",18),x.Ec(1,"Options"),x.Rb())}function Be(t,e){if(1&t){var n=x.Tb();x.Sb(0,"td",19),x.Sb(1,"button",22),x.Zb("click",(function(){x.tc(n);var t=e.$implicit;return x.dc(2).showOptions(t)})),x.Ec(2," OPTIONS "),x.Sb(3,"mat-icon"),x.Ec(4,"more_vert"),x.Rb(),x.Rb(),x.Rb()}}function Te(t,e){1&t&&x.Nb(0,"tr",23)}function Ae(t,e){1&t&&x.Nb(0,"tr",24)}function Ne(t,e){if(1&t&&(x.Sb(0,"table",6),x.Qb(1,7),x.Cc(2,we,2,0,"th",8),x.Cc(3,Ce,3,3,"td",9),x.Pb(),x.Qb(4,10),x.Cc(5,Se,2,0,"th",8),x.Cc(6,ke,2,1,"td",9),x.Pb(),x.Qb(7,11),x.Cc(8,_e,2,0,"th",8),x.Cc(9,Pe,3,4,"td",9),x.Pb(),x.Qb(10,12),x.Cc(11,Re,2,0,"th",8),x.Cc(12,xe,2,1,"td",9),x.Pb(),x.Qb(13,13),x.Cc(14,Ie,2,0,"th",8),x.Cc(15,Oe,2,1,"td",9),x.Pb(),x.Qb(16,14),x.Cc(17,Fe,2,0,"th",8),x.Cc(18,De,3,2,"td",9),x.Pb(),x.Qb(19,15),x.Cc(20,Ee,2,0,"th",8),x.Cc(21,Be,5,0,"td",9),x.Pb(),x.Cc(22,Te,1,0,"tr",16),x.Cc(23,Ae,1,0,"tr",17),x.Rb()),2&t){var n=x.dc();x.jc("dataSource",n.ordersDataTable),x.Bb(22),x.jc("matHeaderRowDef",n.ordersColumns),x.Bb(1),x.jc("matRowDefColumns",n.ordersColumns)}}function We(t,e){1&t&&(x.Sb(0,"div",25),x.Nb(1,"smartstock-data-not-ready"),x.Rb())}var Ve=function(){return[10,20,50]},Le=function(){function t(t,e){this.orderState=t,this.bottomSheet=e,this.ordersDataTable=new g.o([]),this.ordersColumns=["date","customer","amount","paid","mobile","status","action"],this.ordersDataTable.paginator=this.paginator}return t.prototype.ngOnInit=function(){var t=this;this.orderState.orders.subscribe((function(e){t.ordersDataTable.data=e,t.ordersDataTable.paginator||(t.ordersDataTable.paginator=t.paginator)})),0===this.ordersDataTable.data.length&&this.orderState.getOrder(),this.handleTableFilter()},t.prototype.handleTableFilter=function(){var t=this;this.orderState.orderFilterKeyword.subscribe((function(e){t.ordersDataTable.filter=e.toLowerCase()}))},t.prototype.showOptions=function(t){this.bottomSheet.open(Qt,{data:{order:t},closeOnNavigation:!0})},t.\u0275fac=function(e){return new(e||t)(x.Mb(Wt),x.Mb(Vt.b))},t.\u0275cmp=x.Gb({type:t,selectors:[["smartstock-orders-table"]],viewQuery:function(t,e){var n;1&t&&x.Jc(p.a,!0),2&t&&x.oc(n=x.ac())&&(e.paginator=n.first)},decls:9,vars:9,consts:[["mode","indeterminate","color","primary",4,"ngIf"],["mat-table","",3,"dataSource",4,"ngIf"],["class","d-flex justify-content-center align-items-center","style","padding: 16px",4,"ngIf"],[3,"pageSize","showFirstLastButtons","pageSizeOptions"],["paginator",""],["mode","indeterminate","color","primary"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["matColumnDef","customer"],["matColumnDef","amount"],["matColumnDef","paid"],["matColumnDef","mobile"],["matColumnDef","status"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"order"],[4,"ngIf"],["color","primary","mat-button","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"d-flex","justify-content-center","align-items-center",2,"padding","16px"]],template:function(t,e){1&t&&(x.Cc(0,ye,1,0,"mat-progress-bar",0),x.ec(1,"async"),x.Sb(2,"mat-card"),x.Sb(3,"mat-card-header"),x.Nb(4,"smartstock-orders-table-actions"),x.Rb(),x.Cc(5,Ne,24,3,"table",1),x.Cc(6,We,2,0,"div",2),x.Nb(7,"mat-paginator",3,4),x.Rb()),2&t&&(x.jc("ngIf",!0===x.fc(1,6,e.orderState.getOrderFlag)),x.Bb(5),x.jc("ngIf",e.orderState.orders.value.length>0),x.Bb(1),x.jc("ngIf",0===e.orderState.orders.value.length),x.Bb(1),x.jc("pageSize",10)("showFirstLastButtons",!0)("pageSizeOptions",x.lc(8,Ve)))},directives:[r.n,a.a,a.d,Zt,p.a,Gt.a,g.n,g.c,Ut.k,Ut.c,g.k,g.m,g.h,g.a,ge,i.a,l.a,g.j,g.l,ve.a],pipes:[r.b,r.f,r.d],encapsulation:2}),t}(),qe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qe=[{path:"",component:Dt},{path:"order",component:function(t){function e(e){var n=t.call(this)||this;return n.orderState=e,n}return qe(e,t),e.prototype.onSearch=function(t){this.orderState.orderFilterKeyword.next(t)},e.\u0275fac=function(t){return new(t||e)(x.Mb(Wt))},e.\u0275cmp=x.Gb({type:e,selectors:[["smartstock-order-page"]],features:[x.yb],decls:9,vars:5,consts:[[1,"match-parent-side",3,"mode","opened"],["sidenav",""],[2,"min-height","100vh"],["searchPlaceholder","Filter orders",3,"showSearch","heading","sidenav","searchCallback"],[1,"container","col-xl-8","col-lg-9","col-sm-10","col-md-10","col-11",2,"padding","16px 0"],[2,"height","24px"]],template:function(t,e){if(1&t&&(x.Sb(0,"mat-sidenav-container"),x.Sb(1,"mat-sidenav",0,1),x.Nb(3,"smartstock-admin-drawer"),x.Rb(),x.Sb(4,"mat-sidenav-content",2),x.Sb(5,"smartstock-toolbar",3),x.Zb("searchCallback",(function(t){return e.onSearch(t)})),x.Rb(),x.Sb(6,"div",4),x.Nb(7,"div",5),x.Nb(8,"smartstock-orders-table"),x.Rb(),x.Rb(),x.Rb()),2&t){var n=x.pc(2);x.Bb(1),x.jc("mode",e.enoughWidth()?"side":"over")("opened",e.enoughWidth()),x.Bb(4),x.jc("showSearch",!0)("heading","Orders")("sidenav",n)}},directives:[h.b,h.a,A.a,h.c,ot.a,Le],encapsulation:2}),e}(M.a)},{path:"whole",component:Ot},{path:"retail",component:It}],Ze=function(){function t(){}return t.\u0275mod=x.Kb({type:t}),t.\u0275inj=x.Jb({factory:function(e){return new(e||t)},imports:[[r.c,j.e.forChild(Qe),Ft.a,h.d,u.e,o.b,d.c,w.t,a.f,f.b,s.b,l.b,v.c,g.p,i.b,p.b,b.b,c.c,m.c,y.b,z.b,K.b,$.t,H.d,pt.g,w.k,Ut.r,Gt.b,be,Vt.c]]}),t}()}}]);