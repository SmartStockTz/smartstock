"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configureLogger = configureLogger;
exports.addTransport = addTransport;
exports.removeTransport = removeTransport;
exports.default = exports.logger = void 0;

var _winston = _interopRequireDefault(require("winston"));

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _winstonDailyRotateFile = _interopRequireDefault(require("winston-daily-rotate-file"));

var _lodash = _interopRequireDefault(require("lodash"));

var _defaults = _interopRequireDefault(require("../../defaults"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const logger = new _winston.default.Logger();
exports.logger = logger;
const additionalTransports = [];

function updateTransports(options) {
  const transports = Object.assign({}, logger.transports);

  if (options) {
    const silent = options.silent;
    delete options.silent;

    if (_lodash.default.isNull(options.dirname)) {
      delete transports['parse-server'];
      delete transports['parse-server-error'];
    } else if (!_lodash.default.isUndefined(options.dirname)) {
      transports['parse-server'] = new _winstonDailyRotateFile.default(Object.assign({}, {
        filename: 'parse-server.info',
        name: 'parse-server'
      }, options, {
        timestamp: true
      }));
      transports['parse-server-error'] = new _winstonDailyRotateFile.default(Object.assign({}, {
        filename: 'parse-server.err',
        name: 'parse-server-error'
      }, options, {
        level: 'error',
        timestamp: true
      }));
    }

    transports.console = new _winston.default.transports.Console(Object.assign({
      colorize: true,
      name: 'console',
      silent
    }, options));
  } // Mount the additional transports


  additionalTransports.forEach(transport => {
    transports[transport.name] = transport;
  });
  logger.configure({
    transports: _lodash.default.values(transports)
  });
}

function configureLogger({
  logsFolder = _defaults.default.logsFolder,
  jsonLogs = _defaults.default.jsonLogs,
  logLevel = _winston.default.level,
  verbose = _defaults.default.verbose,
  silent = _defaults.default.silent
} = {}) {
  if (verbose) {
    logLevel = 'verbose';
  }

  _winston.default.level = logLevel;
  const options = {};

  if (logsFolder) {
    if (!_path.default.isAbsolute(logsFolder)) {
      logsFolder = _path.default.resolve(process.cwd(), logsFolder);
    }

    try {
      _fs.default.mkdirSync(logsFolder);
    } catch (e) {
      /* */
    }
  }

  options.dirname = logsFolder;
  options.level = logLevel;
  options.silent = silent;

  if (jsonLogs) {
    options.json = true;
    options.stringify = true;
  }

  updateTransports(options);
}

function addTransport(transport) {
  additionalTransports.push(transport);
  updateTransports();
}

function removeTransport(transport) {
  const transportName = typeof transport == 'string' ? transport : transport.name;
  const transports = Object.assign({}, logger.transports);
  delete transports[transportName];
  logger.configure({
    transports: _lodash.default.values(transports)
  });

  _lodash.default.remove(additionalTransports, transport => {
    return transport.name === transportName;
  });
}

var _default = logger;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9Mb2dnZXIvV2luc3RvbkxvZ2dlci5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJ3aW5zdG9uIiwiTG9nZ2VyIiwiYWRkaXRpb25hbFRyYW5zcG9ydHMiLCJ1cGRhdGVUcmFuc3BvcnRzIiwib3B0aW9ucyIsInRyYW5zcG9ydHMiLCJPYmplY3QiLCJhc3NpZ24iLCJzaWxlbnQiLCJfIiwiaXNOdWxsIiwiZGlybmFtZSIsImlzVW5kZWZpbmVkIiwiRGFpbHlSb3RhdGVGaWxlIiwiZmlsZW5hbWUiLCJuYW1lIiwidGltZXN0YW1wIiwibGV2ZWwiLCJjb25zb2xlIiwiQ29uc29sZSIsImNvbG9yaXplIiwiZm9yRWFjaCIsInRyYW5zcG9ydCIsImNvbmZpZ3VyZSIsInZhbHVlcyIsImNvbmZpZ3VyZUxvZ2dlciIsImxvZ3NGb2xkZXIiLCJkZWZhdWx0cyIsImpzb25Mb2dzIiwibG9nTGV2ZWwiLCJ2ZXJib3NlIiwicGF0aCIsImlzQWJzb2x1dGUiLCJyZXNvbHZlIiwicHJvY2VzcyIsImN3ZCIsImZzIiwibWtkaXJTeW5jIiwiZSIsImpzb24iLCJzdHJpbmdpZnkiLCJhZGRUcmFuc3BvcnQiLCJwdXNoIiwicmVtb3ZlVHJhbnNwb3J0IiwidHJhbnNwb3J0TmFtZSIsInJlbW92ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLGlCQUFRQyxNQUFaLEVBQWY7O0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsRUFBN0I7O0FBRUEsU0FBU0MsZ0JBQVQsQ0FBMEJDLE9BQTFCLEVBQW1DO0FBQ2pDLFFBQU1DLFVBQVUsR0FBR0MsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQlIsTUFBTSxDQUFDTSxVQUF6QixDQUFuQjs7QUFDQSxNQUFJRCxPQUFKLEVBQWE7QUFDWCxVQUFNSSxNQUFNLEdBQUdKLE9BQU8sQ0FBQ0ks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T0FBTyxDQUFDSSxNQUFSLEdBQWlCQSxNQUFqQjs7QUFFQSxNQUFJb0IsUUFBSixFQUFjO0FBQ1p4QixJQUFBQSxPQUFPLENBQUNtQyxJQUFSLEdBQWUsSUFBZjtBQUNBbkMsSUFBQUEsT0FBTyxDQUFDb0MsU0FBUixHQUFvQixJQUFwQjtBQUNEOztBQUNEckMsRUFBQUEsZ0JBQWdCLENBQUNDLE9BQUQsQ0FBaEI7QUFDRDs7QUFFTSxTQUFTcUMsWUFBVCxDQUFzQm5CLFNBQXRCLEVBQWlDO0FBQ3RDcEIsRUFBQUEsb0JBQW9CLENBQUN3QyxJQUFyQixDQUEwQnBCLFNBQTFCO0FBQ0FuQixFQUFBQSxnQkFBZ0I7QUFDakI7O0FBRU0sU0FBU3dDLGVBQVQsQ0FBeUJyQixTQUF6QixFQUFvQztBQUN6QyxRQUFNc0IsYUFBYSxHQUNqQixPQUFPdEIsU0FBUCxJQUFvQixRQUFwQixHQUErQkEsU0FBL0IsR0FBMkNBLFNBQVMsQ0FBQ1AsSUFEdkQ7QUFFQSxRQUFNVixVQUFVLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JSLE1BQU0sQ0FBQ00sVUFBekIsQ0FBbkI7QUFDQSxTQUFPQSxVQUFVLENBQUN1QyxhQUFELENBQWpCO0FBQ0E3QyxFQUFBQSxNQUFNLENBQUN3QixTQUFQLENBQWlCO0FBQ2ZsQixJQUFBQSxVQUFVLEVBQUVJLGdCQUFFZSxNQUFGLENBQVNuQixVQUFUO0FBREcsR0FBakI7O0FBR0FJLGtCQUFFb0MsTUFBRixDQUFTM0Msb0JBQVQsRUFBK0JvQixTQUFTLElBQUk7QUFDMUMsV0FBT0EsU0FBUyxDQUFDUCxJQUFWLEtBQW1CNkIsYUFBMUI7QUFDRCxHQUZEO0FBR0Q7O2VBR2M3QyxNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHdpbnN0b24gZnJvbSAnd2luc3Rvbic7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgRGFpbHlSb3RhdGVGaWxlIGZyb20gJ3dpbnN0b24tZGFpbHktcm90YXRlLWZpbGUnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBkZWZhdWx0cyBmcm9tICcuLi8uLi9kZWZhdWx0cyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyB3aW5zdG9uLkxvZ2dlcigpO1xuY29uc3QgYWRkaXRpb25hbFRyYW5zcG9ydHMgPSBbXTtcblxuZnVuY3Rpb24gdXBkYXRlVHJhbnNwb3J0cyhvcHRpb25zKSB7XG4gIGNvbnN0IHRyYW5zcG9ydHMgPSBPYmplY3QuYXNzaWduKHt9LCBsb2dnZXIudHJhbnNwb3J0cyk7XG4gIGlmIChvcHRpb25zKSB7XG4gICAgY29uc3Qgc2lsZW50ID0gb3B0aW9ucy5zaWxlbnQ7XG4gICAgZGVsZXRlIG9wdGlvbnMuc2lsZW50O1xuICAgIGlmIChfLmlzTnVsbChvcHRpb25zLmRpcm5hbWUpKSB7XG4gICAgICBkZWxldGUgdHJhbnNwb3J0c1sncGFyc2Utc2VydmVyJ107XG4gICAgICBkZWxldGUgdHJhbnNwb3J0c1sncGFyc2Utc2VydmVyLWVycm9yJ107XG4gICAgfSBlbHNlIGlmICghXy5pc1VuZGVmaW5lZChvcHRpb25zLmRpcm5hbWUpKSB7XG4gICAgICB0cmFuc3BvcnRzWydwYXJzZS1zZXJ2ZXInXSA9IG5ldyBEYWlseVJvdGF0ZUZpbGUoXG4gICAgICAgIE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAge30sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmlsZW5hbWU6ICdwYXJzZS1zZXJ2ZXIuaW5mbycsXG4gICAgICAgICAgICBuYW1lOiAncGFyc2Utc2VydmVyJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgeyB0aW1lc3RhbXA6IHRydWUgfVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgdHJhbnNwb3J0c1sncGFyc2Utc2VydmVyLWVycm9yJ10gPSBuZXcgRGFpbHlSb3RhdGVGaWxlKFxuICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgIHt9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiAncGFyc2Utc2VydmVyLmVycicsXG4gICAgICAgICAgICBuYW1lOiAncGFyc2Utc2VydmVyLWVycm9yJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgeyBsZXZlbDogJ2Vycm9yJywgdGltZXN0YW1wOiB0cnVlIH1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cmFuc3BvcnRzLmNvbnNvbGUgPSBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoXG4gICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICB7XG4gICAgICAgICAgY29sb3JpemU6IHRydWUsXG4gICAgICAgICAgbmFtZTogJ2NvbnNvbGUnLFxuICAgICAgICAgIHNpbGVudCxcbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgKVxuICAgICk7XG4gIH1cbiAgLy8gTW91bnQgdGhlIGFkZGl0aW9uYWwgdHJhbnNwb3J0c1xuICBhZGRpdGlvbmFsVHJhbnNwb3J0cy5mb3JFYWNoKHRyYW5zcG9ydCA9PiB7XG4gICAgdHJhbnNwb3J0c1t0cmFuc3BvcnQubmFtZV0gPSB0cmFuc3BvcnQ7XG4gIH0pO1xuICBsb2dnZXIuY29uZmlndXJlKHtcbiAgICB0cmFuc3BvcnRzOiBfLnZhbHVlcyh0cmFuc3BvcnRzKSxcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25maWd1cmVMb2dnZXIoe1xuICBsb2dzRm9sZGVyID0gZGVmYXVsdHMubG9nc0ZvbGRlcixcbiAganNvbkxvZ3MgPSBkZWZhdWx0cy5qc29uTG9ncyxcbiAgbG9nTGV2ZWwgPSB3aW5zdG9uLmxldmVsLFxuICB2ZXJib3NlID0gZGVmYXVsdHMudmVyYm9zZSxcbiAgc2lsZW50ID0gZGVmYXVsdHMuc2lsZW50LFxufSA9IHt9KSB7XG4gIGlmICh2ZXJib3NlKSB7XG4gICAgbG9nTGV2ZWwgPSAndmVyYm9zZSc7XG4gIH1cblxuICB3aW5zdG9uLmxldmVsID0gbG9nTGV2ZWw7XG4gIGNvbnN0IG9wdGlvbnMgPSB7fTtcblxuICBpZiAobG9nc0ZvbGRlcikge1xuICAgIGlmICghcGF0aC5pc0Fic29sdXRlKGxvZ3NGb2xkZXIpKSB7XG4gICAgICBsb2dzRm9sZGVyID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIGxvZ3NGb2xkZXIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgZnMubWtkaXJTeW5jKGxvZ3NGb2xkZXIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8qICovXG4gICAgfVxuICB9XG4gIG9wdGlvbnMuZGlybmFtZSA9IGxvZ3NGb2xkZXI7XG4gIG9wdGlvbnMubGV2ZWwgPSBsb2dMZXZlbDtcbiAgb3B0aW9ucy5zaWxlbnQgPSBzaWxlbnQ7XG5cbiAgaWYgKGpzb25Mb2dzKSB7XG4gICAgb3B0aW9ucy5qc29uID0gdHJ1ZTtcbiAgICBvcHRpb25zLnN0cmluZ2lmeSA9IHRydWU7XG4gIH1cbiAgdXBkYXRlVHJhbnNwb3J0cyhvcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFRyYW5zcG9ydCh0cmFuc3BvcnQpIHtcbiAgYWRkaXRpb25hbFRyYW5zcG9ydHMucHVzaCh0cmFuc3BvcnQpO1xuICB1cGRhdGVUcmFuc3BvcnRzKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVUcmFuc3BvcnQodHJhbnNwb3J0KSB7XG4gIGNvbnN0IHRyYW5zcG9ydE5hbWUgPVxuICAgIHR5cGVvZiB0cmFuc3BvcnQgPT0gJ3N0cmluZycgPyB0cmFuc3BvcnQgOiB0cmFuc3BvcnQubmFtZTtcbiAgY29uc3QgdHJhbnNwb3J0cyA9IE9iamVjdC5hc3NpZ24oe30sIGxvZ2dlci50cmFuc3BvcnRzKTtcbiAgZGVsZXRlIHRyYW5zcG9ydHNbdHJhbnNwb3J0TmFtZV07XG4gIGxvZ2dlci5jb25maWd1cmUoe1xuICAgIHRyYW5zcG9ydHM6IF8udmFsdWVzKHRyYW5zcG9ydHMpLFxuICB9KTtcbiAgXy5yZW1vdmUoYWRkaXRpb25hbFRyYW5zcG9ydHMsIHRyYW5zcG9ydCA9PiB7XG4gICAgcmV0dXJuIHRyYW5zcG9ydC5uYW1lID09PSB0cmFuc3BvcnROYW1lO1xuICB9KTtcbn1cblxuZXhwb3J0IHsgbG9nZ2VyIH07XG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XG4iXX0=